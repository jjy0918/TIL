## 인프런 Spring Security 정리(09/01)

<br>

## 섹션0. 스프링 시큐리티 : 폼 인증

<hr>

### 스프링 시큐리티 커스터마이징 : JPA 연동

UserDetailService

- loadUserByUsername
  - username을 받아서 UserDetails를 리턴해준다.
  - DAO에서 username을 이용하여 가져온다.
  - username이 없는 경우 예외를 던진다.
  - username이 있는 경우 UserDetails 타입으로 변화하여 리턴한다.
- Spring Security에서 UserDetails를 간단하게 만들 수 있도록 User객체를 제공한다.
- Spring Security에서 제공하는 것.
- Authentication 관리 시 DAO를 통해서 유저 정보를 읽어온다.
- 인터페이스 구현 시 어떠한 DAO 구현체를 사용하는지는 상관 없다.
-

```java

public AccountService implements UserDetailsService{

    @Autowired
    AccountRepository accountRepository;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException{
        Account account = accountRepository.findByUsername(username);
        if(account == null){
            throw new UsernameNotFoundException(username);
        }

        return User.builder()
            .username(account.getUsername())
            .password(account.getPassword())
            .roles(account.getRole())
            .build();
    }
}


```

- SpringSecurity는 password에 특별한 패턴을 요구한다.
- {암호화 알고리즘 패턴}비밀번호
- {noop}password 라 하면 비밀번호 암호화 하지 않도록 만들어준다.

- WebSecurityConfigurerAdapter를 구현한 클래스의 configure(AuthenticationManagerBuilder auth) 메소드 오버라이드한 부분에서 DetailService를 등록할 수 있다.
  - bean으로 등록한 경우 하지 않아도 된다.

```java

@Override
protected void configure(AuthenticationManagerBuilder auth) thorws Exception{
    // accountService는 UserDetailsService를 구현한 클래스

    auth.userDetailsService(accountService);
}


```

### 스프링 시큐리티 커스터마이징 : PasswordEncoder

SpringSecurity에는 password 기본 포맷이 존재한다.

- {noop}password

```java

@Bean
public PasswordEncoder passwordEncoder(){
    // 기본은 bcrypt
    return PasswordEncoderFactories.createDelegatingPasswordEncoder();
}

////
this.password = passwordEncoder.encode(this.password);

```
