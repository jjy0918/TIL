# 4.데이터 링크 계층 랜에서 데이터 전송하기

## 4-1.데이터 링크 계층의 역할과 이더넷

### 이더넷이란?

- 데이터 링크 계층에서 랜으로 데이터를 주고 받기 위해서는 랜을 이용한다.
- 데이터 링크 계층은 네트워크 장비 간 신호를 주고 받는 규칙을 정하는 계층이다.
- 데이터를 주고 받는 규칙 중 일반적으로 많이 사용하는 규칙이 이더넷이다.
- 이더넷은 전송 받는 데이터가 목적지가 아닌 경우 무시한다.
- 데이터 전송 시 충돌을 일어나지 않도록 전송 시점을 늦춘다.
- 데이터 전송 시점을 늦추는 방법을 CSMA/CD 라고 한다.
  - CS : 데이터를 보내려고 하는 컴퓨터의 케이블에 신호가 있는지 확인
  - MA : 케이블에 데이터가 없다면 전송해도 된다.
  - CD : 충돌이 발생하고 있는지 확인한다.
  - 현재는 CSMA/CD를 사용하고 있지는 않는다.

## 4-2. MAC 주소의 구조

### MAC 주소란?

- 랜카드의 고유한 번호(물리 주소)
- 전 세계에서 유일한 번호로 할당된다.
- 48비트로 구성되어 있고 앞 24비트는 랜 카드의 제조사, 뒤 24비트는 제조사가 붙인 일련번호이다.
- 데이터링크 계층에서는 이더넷의 헤더와 트레일러를 붙인다.
- 헤더는 목적지의 MAC 주소(6Byte) + 출발지의 MAC 주소(6Byte) + 유형(2Byte) 로 구성된다.
  - 유형은 상위 계층의 프로토콜 종류를 의미한다.
  - IPv4, ARP, RARP, SNMP over Ethernet, IPv6 등
- 트레일러는 FCS(Frame Check Sequence)라고 하며, 오류가 발생했는지 체크할 때 사용된다.
- 헤더 + 데이터 + 트레일러 = 프레임
- 데이터 링크 계층에서는 프레임을 전송한다.
- MAC 주소를 기준으로 본인에게 온 데이터가 아닌 경우 데이터를 파기한다.

## 4-3. 스위치의 구조

### MAC 주소 테이블이란?

- 스위치는 데이터 링크 계층에서 동작하고, 레이어 2 스위치 또는 스위칭 허브라고 불린다.
- 스위치 내부에는 MAC 주소 테이블이 존재한다.
- MAC 주소 테이블에는 스위치의 포트 번호와 해당 포트에 연결된 컴퓨터의 MAC 주소가 등록되어 있다.
- 프레임을 전송하면, MAC 주소 테이블에서 주소를 확인 후 전송한다.
- 출발지 MAC 주소가 등록되어 있지 않으면, MAC 주소를 포트와 함께 등록한다.(MAC 주소 학습 기능)

### MAC 주소 테이블 저장 과정.

- 스위치와 연결된 5개의 컴퓨터가 있다고 가정하자.

1.  컴퓨터1이 컴퓨터3에게 데이터를 전송한다.
2.  MAC 주소 테이블에 컴퓨터 1의 주소가 저장된다.
3.  컴퓨터3의 주소는 없기 때문에 나머지 포트에 프레임을 전송한다. 이것을 플러딩이라고 한다.
4.  컴퓨터3의 주소가 있다면, 다른 포트는 제외되고 컴퓨터3의 포트로만 프레임이 전송된다. 이것을 MAC 주소 필터링이라고 한다.

## 4-4. 데이터가 케이블에서 충돌하지 않는 구조

### 전이중 통신과 반이중 통신

- 전이중 통신 방식 : 데이터의 송수신을 동시에 진행(랜케이블)
- 반이중 통신 방식 : 송신과 수신을 번갈아가며 진행(허브)
- 전이중 방식은 동시에 데이터를 전송하면 충돌이 발생하지 않지만, 반이중은 충돌이 발생한다.
- 허브는 동시에 데이터를 전송하면 충돌이 발생하지만, 스위치는 충돌이 일어나지 않도록 되어있다.
- 그렇기 때문에 허브보다는 스위치가 효율이 더 좋다.

### 충돌 도메인이란?

- 충돌이 발생할 때 그 영향이 미치는 범위
- 허브에서 충돌이 발생하면, 그 허브위 연결된 모튼 컴퓨터는 충돌 도메인이 된다.
- 스위치는 전이중 방식이기 때문에 충돌이 발생하지 않고, 충돌 도메인도 좁다.
- 충돌 도메인이 넓을수록 네트워크가 지연된다.

### ARP

- IP 주소를 바탕으로 MAC 주소를 찾는 프로토콜
- 반대로 MAC 주소로 IP 주소를 찾는 프로토콜은 RARP라고 한다.
- 컴퓨터는 목적지 MAC 주소를 모를 경우 MAC 주소를 찾기 위해 네트워크에 브로드캐스트를 요청하고, 이를 ARP 요청이라고 한다.
- 브로드캐스트 요청 후 해당 IP를 가진 컴퓨터가 응답을 보낸다. 이것을 ARP 응답이라고 한다.
- ARP 응답은 출발지 컴퓨터의 메모리(ARP 테이블)에 저장한다.
- 즉, 컴퓨터는 처음에 ARP 테이블을 기준으로 MAC 주소를 찾는다.
- ARP 테이블은 일정 기간 가지고 있고, 기간이 지나면 다시 요청한다.

## 4-5. 이더넷의 종류와 특징

### 이더넷 규격

- 이더넷은 통신 속도에 따라 다양한 규격으로 분리된다.
- 10BASE5, 10BASE2, 10BASE-T 등
- 10BASE-T에서 10은 통신 속도(10Mbps)를 나타내고, BASE는 BASEBAND라는 전송 방식을 나태내고, T는 케이블을 나타낸다.
- 케이블에서 그냥 숫자는 동축케이블이고, -가 붙은 것은 UTP 케이블을 의미한다.
- 10BASE5 => 500m 동축 케이블, 10BASE-T => UTP 케이블
