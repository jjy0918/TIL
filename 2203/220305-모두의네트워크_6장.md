# 모두의 네트워크 6장 - 전송 계층 : 신뢰할 수 있는 데이터 전송하기

## 전송 계층의 역할

### 전송 계층의 두 가지 역할

- 전송 계층에서는 목적지에 신뢰할 수 있는 데이터를 전달할 수 있게 도와준다.
- 오류 점검 기능등을 통해 오류가 발생하면 데이터를 재전송하도록 요청한다.
- 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능도 있다.

### 연결형 통신과 비연결형 통신

- 연결형 통신은 데이터를 정확하게 전달하여 신뢰성이 있다.
  - 연결형 통신은 상대편과 확인해 가면서 통신하는 방식이다.
  - 연결형 통신의 대표적인 프로토콜은 TCP가 있다.
- 비연결형 통신은 효율적으로 데이터를 전달하여 빠르다.
  - 비연결형 통신은 상대편을 확인하지 않고, 일방적으로 데이터를 전송하는 방식이다.
  - 비연결형 통신의 대표적인 프로토콜은 UDP가 있다.
  - 동영상 서비스의 경우 비연결형 통신을 사용한다.

## TCP의 구조

### TCP란?

- 전송 계층에서 TCP 통신을 할 때 TCP 헤더를 붙여 캡슐화를 한다.
- TCP 헤더를 붙인 데이터를 세그먼트라고 한다.
- TCP 헤더에는 출발지 포트 번호, 목적지 포트 번호, 일련번호, 확인 응답 번호, 헤더 길이, 예약 영역, 코드 비트, 윈도우 크기, 체크섬, 긴급 포인터, 옵션이 있다.
- TCP에서는 연결할 때 코드비트 부분의 6비트의 데이터를 사용한다.
  - 그 중 SYN은 연결 요청, ACK은 확인 응답을 뜻한다.

### 3-way handshake

- TCP 에서 연결할 때 과정.

1.  컴퓨터1은 SYN을 이용해 컴퓨터2에게 연결 확립을 요청한다.
2.  컴퓨터2는 SYN + ACK을 이용해 컴퓨터1에게 연결확립 응답과 연결 확립 요청을 한다.
3.  컴퓨터1은 ACK을 통해 연결 확립 응답을 한다.

- 이러한 과정이 3-way handshake이다.

### 4-way handshake

- 연결을 종료할 때는 FIN과 ACK을 사용한다.
  - FIN은 연결 종료를 뜻한다.

1.  컴퓨터1이 FIN을 이용해 연결 종료를 요청한다.
2.  컴퓨터2는 ACK을 이용해 연결 종료 요청에 대한 응답을 한다.
3.  컴퓨터2는 FIN을 이용해 연결 종료 요청을 한다.
4.  컴퓨터1은 ACK을 이용해 연결 종료 응답을 한다.

## 일련번호와 확인 응답 번호의 구조

### 일련번호와 확인 응답 번호

- TCP에서는 데이터를 분할하여 보내는데, 일련 번호를 통해 수신측에서 몇 번째 데이터인지 확인이 가능하다.
- 확인 응답 번호를 통해, 송신측에서 수신측이 몇 번째 데이터까지 받았는지 확인이 가능하다.
- 일련번호와 확인 응답 번호를 이용하여 데이터가 유실된 경우 재전송을 요청할 수 있다.

### 윈도우 크기란?

- 세그먼트(데이터)를 매번 확인하고 보내는 것이 아니다.
- 매번 응답을 기다리는 대신 세그먼트를 연속으로 보낸 후 확인 응답을 반환하여 효율을 높인다.
- 내부적으로 버퍼가 있기 때문에 연속적으로 세그먼트를 보내도 된다.
- 윈도우 크기를 통해 버퍼의 크기를 알 수 있다.
- 윈도우 크기의 초깃값은 3-way handshake를 할 때 판단한다.

## 포트 번호와 구조

### 포트번호란?

- TCP헤더의 출발지 포트 번호와 목적지 포트 번호를 통해 애플리케이션을 구분할 수 있다.
- 포트 번호는 0~65535번을 사용할 수 있다.
- 0~1023번 포트는 주요 프로토콜이 사용하도록 예약되어 있다.
- 애플리케이션은 각각 포트 버놓가 존재하여, 애플리케이션마다 구분할 수 있다.

## UDP 구조

### UDP란?

- UDP는 데이터를 효율적으로 빠르게 보낸다.
- TCP 처럼 많은 과정을 거쳐서 통신하지 않는다.
- 스트리밍 방식으로 전송하는 동영상 서비스 등에서 사용된다.

### UDP 헤더란?

- UDP 헤더를 붙여 캡슐화한 데이터를 UDP 데이터그램이라고 한다.
- UDP 헤더에는 출발지 포트 번호, 목적지 포트 번호, 길이, 체크섬이 있다.
- UDP는 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있다.(브로드캐스트)
- TCP의 경우 브로드 캐스트를 위해서는 네트워크의 모든 장비와 3-way를 해야 하기 때문에 비효율적이다.
