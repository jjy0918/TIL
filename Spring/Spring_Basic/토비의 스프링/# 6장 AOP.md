# 6장 AOP

- AOP는 IoC/DI, 서비스 추상화와 더불어 스프링 3대 기반기술 중 하나다.

## 6.1 트랜잭션 코드의 분리

- 지금까지 작성한 UserService 코드는 트랜잭션 경계설정 관련된 코드를 계속해서 넣어주어야 한다.
- 트랜잭션 경계설정 코드와 비즈니스 로직 코드는 뚜렷하게 구분되어 있기 때문에 서로간 주고받는 정보가 없다.
  - 비즈니스 로직에서는 직접 DB를 사용하지 않기 때문에 DB 커넥션 정보가 필요 없다.
  - 즉, 트랜잭션 로직과 비즈니스 로직은 코드 성격도 다르고 주고 받는 데이터도 없는 완벽하게 독립적인 코드라고 할 수 있다.
- 이를 해결하기 위해 UserService를 인터페이스로 만들고, 실제 비즈니스 로직을 가지는 `UserServiceImpl`과 트랜잭션 경계를 담당하는 `UserServiceTx` 로 나눈다.
  - `UserServiceTx`는 트랜잭션을 담당하고, 실제 비즈니스 로직은 `UserServiceImpl`에서 수행한다
- 트랜잭션 코드를 분리하는 것의 장점
  - 비즈니스 로직을 담당하고 있는 부분과 트랜잭션을 담당하는 부분이 나뉘기 때문에 비즈니스 로직에서는 트랜잭션에 관련된 부분을 몰라도 된다.
  - 비즈니스 로직에 대한 테스트를 손쉽게 만들어낼 수 있다.

## 6.2 고립된 단위 테스트

- 일반적으로 테스트는 가능한 한 작은 단위로 쪼개서 테스트하는 것이다.
  - 작은 단위 테스트는 실패했을 때 원인 찾기가 쉽다.
  - 또한 테스트 의도나 내용이 분명해지고 만들기가 쉽다.

### 테스트 대상 오브젝트 고립시키기

- 일반적으로 클래스는 다양한 의존 오브젝트를 가지고 있기 때문에 테스트를 하기 위해서 불필요한 작업을 할 수 있다.
- 그렇기 때문에 테스트의 대상이 환경이나 외부 클래스에 종속되거나 영향을 받지 않도록 고립시킬 필요가 있다.
- 테스트 대상 오브젝트를 고립시키기 위해서 테스트 대역을 사용하는 것이 가장 좋다.

### 단위 테스트와 통합 테스트

- 단위 테스트는 테스트 대역을 통해 외부 오브젝트나 외부 리소스를 사용하지 않고 고립시켜서 테스트하는 것을 말한다.
- 통합 테스트는 외부 오브젝트나 외부 리소스를 참여하는 테스트를 말한다.
  - 즉, 통합 테스트란 두 개 이상의 단위가 결합하여 동작하면서 테스트가 수행되는 것이라 할 수 있다.

### 목 프레임워크

- 단위 테스트에서 대상 오브젝트를 고립시키기 위해서 목 오브젝트를 만들어주어야 하지만, 매번 만들어주기 굉장히 번거롭니다.
- 목 오브젝트를 간단하게 만드는 것을 도와주는 목 오브젝트 지원 프레임워크가 존재한다.
  - `Mockito 프레임워크` 등
