# 01. JPA 소개

## 1.1 SQL을 직접 다룰 때 발생하는 문제점

- 자바로 개발하는 애플리케이션은 대부분 관계형 데이터베이스를 데이터 저장소로 사용한다.
- 데이터베이스는 데이터를 관리하기 위해 SQL을 사용한다.
- 자바에서는 SQL을 사용하기 위해 JDBC API를 사용한다.

### 1.1.1 반복, 반복 그리고 반복

- JDBC API를 이용하여 SQL을 다룰 때 비슷한 작업이 너무 많이 일어난다.
  - SQL 작성 -> JDBC API 이용하여 SQL 실행 -> 결과 조회 후 객체로 매핑
- 데이터베이스의 테이블이 많아질수록 이러한 반복되는 과정이 많아진다.

### 1.1.2 SQL에 의존적인 개발

- 객체가 어떠한 값을 사용할 지 또는 변경이 되는 것은 전적으로 SQL에 달려있다.
- 즉, SQL에 의존적인 객체가 만들어진다는 것이다.
- SQL에 의존적인 객체는 개발자들이 신뢰할 수 없다.(어떻게 구현이 되는지 반드시 확인해야 한다.)
- 엔티티가 SQL에 의존적이다 보니, 필드 추가 등에도 CRUD 코드와 SQL 모두 변경해야 한다.
- 정리하자면, 진정한 의미의 계층 분할이 어렵고 엔티티를 신뢰할 수 없으며, SQL에 의존적인 개발을 피하기 어렵게 만든다.

### 1.1.3 JPA와 문제 해결

- JPA는 개발자 대신 SQL을 작성하여 실행시켜주기 때문에 객체와 관계형 데이터베이스의 패러다임 차이를 해결한다.

## 1.2 패러다임 불일치

- 객체와 관계형 데이터베이스는 지향하는 목적이 다르기 때문에 패러다임 불일치가 발생할 수 있다.
  - 객체는 상속이 가능하지만, 데이터베이스에는 상속이 없다.
- JPA는 이러한 객체와 관계형 데이터베이스 간 패러다임 불일치를 해결해준다.

### 1.2.1 상속

- 객체는 상속 기능을 제공하지만, 데이터베이스는 상속을 제공하지 않는다.
- 객체의 상속과 관련된 데이터를 저장하기 위해서는 관련된 모든 객체에 맞는 SQL을 직접 작성해야 한다.
  - `Item` 객체를 상속받은 `Album`, `Movie`, `Book`이 있다면, INSERT INTO ITEM..., INSERT INTO MOVIE.. 등을 모두 작성해야 한다.
  - 이러한 과정이 모두 패러다임의 불일치를 해결하기 위한 비용이다.

#### JPA 상속

- JPA는 상속과 관련된 패러다임 불일치를 모두 해결해준다.
- 마지 자바 컬렉션에 객처를 저장하듯 저장해줄 수 있다.
  - jap.persist(album);

### 1.2.2 연관관계

- 객체는 참조를 통해 다른 객체와 연관관계를 참조에 접근하여 조회할 수 있다.
- 테이블은 외래 키를 사용하여 다른 테이블과 연관관계를 가지고 조인을 통해 조회한다.
- 데이터베이스에 객체지향 모델링을 맞추면, 좋은 객체지향 모델링이 어려워진다. 그 반대도 마찬가지다.
- JPA는 연관관계 관련된 패러다임 불일치 문제를 해결해준다.

### 1.2.3 객체 그래프 탐색

- SQL은 객체 그래프 탐색에 한계가 존재한다.
- JPA는 객체 그래프 탐색을 지속적으로 할 수 있도록 지원해준다.
- 모든 객체를 한번에 조회하는 것이 아니라 지연 로딩을 제공하여 필요할 떄 조회할 수 있도록 도와준다.

### 1.2.4 비교

- 데이터베이스는 기본 키 값으로 각 row를 구분한다.
- 객체는 동일성(identity) 비교와 동등성(equality) 비교를 통해 비교한다.
  - 동일성 비교는 == 비교로 인스턴스 주소 값을 비교한다.
  - 동등성 비교는 equals() 메소드를 사용하는 것으로 내부의 값을 비교한다.
- JPA는 같은 트랜잭션 상에서 같은 객체가 조회되는 것을 보장하기 때문에 동일성 비교가 가능해진다.

## 1.3 JPA란 무엇인가?

- JPA(Java Persistence API)는 자바 진영 ORM 기술이다.
  - JPA는 JDBC와 애플리케이션 사이에서 동작한다.
  - 애플리케이션 <-> JPA <-> JDBC-API <-> DB
- ORM(Object-Relational Mapping)이란 객체와 관계형 데이터베이스를 매핑하여 패러다임 불일치 문제를 해결해주는 프레임워크다.
  - ORM을 사용하면 자바 컬렉션에 저장하듯이 DB에 저장할 수 있다.
- ORM을 통해 객체는 객체만의 모델링을, 데이터베이슨느 데이터베이스만의 모델링을 할 수 있게 된다.
- 자바진영에서는 ORM 프레임워크 중 하이버네이트를 많이 사용한다.

### 1.3.1 JPA 소개

- JPA는 자바 ORM 기술에 대한 API 표준 명세이다.
  - 즉, 인터페이스를 모아둔 것이다.
- JPA를 사용하기 위해서는 JPA를 구현한 ORM 프레임워크를 선택해야 한다.
  - ORM 프레임워크로는 하이버네이트, EclipseLink, DataNucleus가 있다.
  - 이 중 하이버네이트가 가장 대중적이다.
- JPA 표준 덕분에 특정 구현 기술에 대한 의존도를 줄일 수 있고, 다른 기술로 쉽게 이동할 수 있다.

### 1.3.2 왜 JPA를 사용해야 하는가?

- JPA를 사용하면 SQL 처리 등 반복적인 작업을 대신 처리해주기 때문에 생산성이 올라간다.
- 엔티티에 특정 데이터를 추가하거나 SQL 변경 등의 작업도 간단하게 처리되기 때문에 유지보수하기도 쉬워진다.
- 패러다임 불일치도 해결할 수 있다.
- JPA는 같은 트랜잭션안에서 데이터 조회 시 쿼리를 실행안하거나 SQL 힌트등을 통해 성능 향상을 가져온다.
- JPA를 이용하면 특정 데이터베이스 밴더에 대해 종속적이지 않을 수 있다.