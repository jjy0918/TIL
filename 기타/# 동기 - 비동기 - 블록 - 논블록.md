# 동기 - 비동기 - 블록 - 논블록

- 일반적으로 동기와 블록, 비동기와 논블록을 하나로 묶는다.
- 엄밀히 때져보면, 4개의 상태 모두 다른 것을 의미한다.
- 4가지 상태는 결국 하나의 프로세스 or 스레드가 어떻게 동작하는 것인가의 관점에서 보면 서로 다른 것이다.
- 아래 나오는 4가지 상태의 예시에서 나 라는 것이 프로세스 or 스레드 라고 보면 된다.

## 동기(Synchronous)

- 동기라는 것은 순차적으로 특정 작업을 하는 것이다.
- 즉, 내가 어떠한 작업을 순차적으로 처리한다면 동기적으로 처리한다고 할 수 있다.
- 중요한 점은 순차적으로 처리한다는 것이다. 간단하게 여러 사람이 있다고 해도 순차적으로 일을 처리하면 동기적으로 처리하는 것이다.
- 해야 할 일이 A, B, C, D 가 있다고 하면, 나 혼자 또는 여러 사람이 A -> B -> C -> D 순서로 일을 처리하는 것이다.

## 비동기(Asynchoronous)

- 비동기라는 것은 비순차적으로 작업을 하는 것이다.
- 즉, 내가 어떠한 작업을 하고 있을 때 다른 사람이 내가 해야 하는 작업을 같이 처리하는 것이다.
- 해야 할 일이 A, B, C, D 가 있다고 하면, 내가 A를 처리할 때 다른 사림이 B or C or D 작업을 처리하면 비동기이다.

## 블록(Blocking)

- 블록은 내가 어떤 일을 하던 중 대기해야 하는 상황에서 대기하는 것이다.
- 내가 A라는 일을 하다가 대기해야 한다면, 다른 일을 하지 못하고 대기하는 것이다.

## 논 블록(Non-Blocking)

- 논블록은 내가 어떤 일을 하던 중 대기해야 할 때 다른 작업을 할 수 있는 것이다.
- 내가 A라는 일을 하다가 대기해야 한다면, 대기하지 않고 다른 일(B, C, D)를 하는 것이다.

## 정리

- 동기 - 비동기 는 일을 순차적으로 하느냐, 비순차적으로 일을 하느냐의 차이다.
- 블록 - 논블록 은 블록킹 상황에서 내가 어떻게 대응할 것인가라고 보면 된다.
  - 블록킹 상황에서 그대로 대기하면 블록, 다른 일을 하면 논블록이다.

## 조합

### 1. 동기-블록

- 동기로 동작하면서 블록 상태라는 것은 일반적인 경우이다.
- 즉, 블록 상황이 되었을 때 완료될 때 까지 대기해야 하고 나는 그 동안 아무것도 하지 못하는 상태이다.
- 간단한 예시로 내가 커피를 마시기 위해 커피 머신의 버튼을 누른 경우, 커피 머신이 커피를 내려줄 때 까지 대기하면서 아무것도 안하는 것이다.
- 일반적은 I/O에서 흔히 확인할 수 있다.
  - 스레드는 커널에 I/O 작업을 요청하면 애플리케이션은 커널이 I/O 작업을 완료할 때 까지 기다린 후 다시 작업을 재개한다.

```
A스레드  ----->        ----->
             |       |
B스레드        ------->
```

### 2. 동기-논블록

- 동기로 동작하면 논블록 상태라는 것은 대기해야 할 때 기다리지 않는 것이다.
- 내가 커피 머신의 버튼을 누른 후 커피가 내려오는 것과 상관 없이 다른 일을 하는 것이다.
  - 다른 일을 하다가, 커피가 완료되었나 확인한 후 완료되면 마시면 된다.
- 스레드는 커널에 I/O 작업을 요청 한 후 해당 Task가 아닌 다른 Task를 하다가 지속적으로 완료되었는지 확인 후 완료되면 다시 돌아와 처리하는 것이다.
  - 중요한 것은 하나의 스레드가 여러 Task를 가지고 있는 상태이고, 블록될 상황에서 다른 Task를 처리할 수 있기 때문에 효율적으로 스레드를 동작시킬 수 있다.
  - 다른 Task라는 것은 말 그대로 다른 작업을 의미한다. 블록된 Task는 I/O 작업이 완료되어야 진행할 수 있기 때문에 진행되지 않는다.
  - 즉, 논블록이라는 것은 스레드를 의미하는 것이지 Task를 의미하는 것이 아니다.
- js의 이벤트 루프나, 리액티브 프로그래밍, 코루틴 등이 이러한 방식으로 논블록킹을 제공한다.
- 콜백으로 다음 행동을 넘기는 것도 논블록킹 방식으로 구현한 것이라 할 수 있다.

```
A스레드         ------>       <<  Task2
             |       |
A스레드  ------        --->    << Task1
             |       |
B스레드        ------->        << Task1
```

```
A스레드        --------->       <<  Task2
             |       
A스레드  ------                 << Task1
             |       
B스레드        ---------->      << Task1
```

### 3. 비동기-블록

- 비동기로 동작하면서 블록된다는 것은, 블록될 상황에서 다른 누군가가 대신 기다려주고 나는 다른 일을 할 수 있는 것이다.
- 내가 커피를 마시기 위해 친구한테 부탁하고 나서 나는 책을 읽고 있고 나서 커피를 마시려 하는데, 친구는 커피를 완성하지 못한 경우 기다리게 되는 상태이다.
- 스레드에서 일을 시킨 후 해당 스레드가 값을 반환할 때 까지 기다리는 것이다.

```
A스레드  ------        --->    << Task1
             |       |
B스레드    --------------->    << Task1
```

### 4. 비동기-논블럭

- 비동기로 동작하면서 대기해야할 때 다른 일을 할 수 있는 것이다.
- 커피 머신을 누르는 동작을 친구가 해주는데, 나는 커피를 기다리면서 책을 읽고 있고 나서 커피를 마시려 할 때, 친구가 커피를 완성이 하지 못하면 나는 운동을 하고 있는 상태이다.
  - 원래 Task는 물 마시기 -> 책 읽기 -> 커피 마시기 로 진행 해야 하는데, 전혀 다른 Task인 운동하기를 남는 시간에 하는 것이다.

```
A스레드         ------>       <<  Task2
             |       |
A스레드  ------        --->    << Task1
             |       |
B스레드    --------------->    << Task1
```

```
A스레드         --------->      <<  Task2
             |       
A스레드  ------                 << Task1
             |       
B스레드    --------------->    << Task1
```

### 예시

요리를 해야 한다.
오늘의 요리는 김치찌개, 계란 볶음밥, 돈까스

블록-동기
내가 김치찌개를 한다.
친구는 기다렸다가 내가 끝나면 계란 볶음밥을 한다.
그 동안 나는 또 기다린 후 완료되면 돈까스를 한다.
--> 일반적인 구현

논블록-동기
내가 김치찌개를 한다.
친구는 기다렸다가 내가 끝나면 계란 볶음밥을 한다.
이때 나는 친구가 계란 볶음밥을 끝내면 돈까스를 해야 하지만 시간이 남으니까 게임을 한다.(요리와 전혀 다른 Task)
--> 이벤트 루프
초기 단계 Queue(음식 Task, 게임 Task) -> 음식 Task 꺼낸 후 run --> 김치찌개를 하게 됨
친구가 계란 볶음밥 시작
김치찌개 완료되었는데 계란 볶음밥이 완료되어야 하기 때문에 다시 Queue에 넣음 Queue(게임 Task, 음식 Task) -> 게임 꺼내서 진행
친구가 계란 볶음밥 완료 --> Queue에서 음식 Task를 꺼내게 되면 시작(완료 안되면 다시 대기)
--> Queue에 음식 Task만 있는 경우 계속 친구가 완료 했는지 확인함.

블록-비동기
내가 김치찌개를 한다.
동시에 친구는 계란 볶음을 한다.
돈까스는 계란 볶음밥이 완료된 후 해야 하기 때문에 내가 먼저 완료되어도 친구를 기다린다.
--> 친구가 동시에 시작하는데, 내가 일찍 끝나서 기다려야 함.

논블록-비동기

내가 김치찌개를 한다.
동시에 친구는 계란 볶음을 한다.
돈까스는 계란 볶음밥이 완료된 후 해야 하기 때문에 내가 먼저 완료되어도 친구를 기다리지 않고 시간이 남으니까 게임을 한다.(요리와 전혀 다른 Task)
--> 이벤트 루프
초기 단계 Queue(음식 Task, 게임 Task) -> 음식 Task 꺼낸 후 run --> 김치찌개를 하게 됨
친구도 계란 볶음밥 같이 시작
김치찌개 완료되었는데 계란 볶음밥이 완료되어야 하기 때문에 다시 Queue에 넣음 Queue(게임 Task, 음식 Task) -> 게임 꺼내서 진행
친구가 계란 볶음밥 완료 --> Queue에서 음식 Task를 꺼내게 되면 시작(완료 안되면 다시 대기)
--> Queue에 음식 Task만 있는 경우 계속 친구가 완료 했는지 확인함.