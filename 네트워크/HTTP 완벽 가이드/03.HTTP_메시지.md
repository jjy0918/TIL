# 3. HTTP 메시지

## 3.1 메시지의 흐름

- HTTP 메시지는 메시지의 내용과 의미를 설명하는 텍스트 메타 정보와 데이터로 이루어져 있다.
- 이러한 메시지는 4가지 방향이 존재한다.
  - 인바운드
  - 아웃바운드
  - 업스트림
  - 다운스트림

### 3.1.1 메시지는 원 서버 방향을 인바운드로 하여 송신된다.

- 각 메시지가 여러 프락시 서버를 거쳐 원 서버로 가는 것이 인바운드이다.
- 각 메시지가 원 서버에서 사용자에게 돌아가는 것이 아웃바운드이다.

### 3.1.2 다운스트림으로 흐르는 메시지

- 모든 HTTP 메시지는 응답과 요청에 상관 없이 다운스트림으로 흐른다.
- 업스트림이란 다운스트림의 반대를 의미한다.
- 예를 들어, 사용자가 서버에 데이터를 요청하는 경우를 가정하자.
  1. 메시지의 흐름은 사용자 -> 프락시 서버 1 -> 프락시 서버 2 -> 원 서버 가 된다.
  2. 모든 메시지는 다운스트림으로 흐르기 때문에 사용자 -> 프락시1, 프락시1 -> 프락시2, 프락시2 -> 원 서버 모두 다운스트림이다.
  3. 여기서 프락시1은 프락시 2가 볼 때 업스트림이 된다.

## 3.2 메시지의 각 부분

- HTTP 메시지는 시작줄, 헤더 블록, 본문 세 부분으로 이루어진다.
- 시작줄은 어떤 메시지인지 서술되어 있다.
- 헤더 블록은 속성이 서술되어 있으며, 필수가 아니다.
- 본문은 데이터를 담고 있으며, 필수가 아니다.
- 시작줄과 헤더는 줄 단위로 구분된 아스키 문자열이며, 각 줄은 캐리지 리턴(ASCII 13)과 개행(ASCII 10) 문자로 구분된다.

### 3.2.1 메시지 문법

- HTTP 메시지는 요청 메시지와 응답 메시지로 구분되며, 시작줄의 내용만 다르다.

```
// 요청 메시지 형식
<메서드> <요청 URL> <버전>
<헤더>

<엔티티 본문>

// 요청 메시지 예시
GET /specials/saw-blade.gif HTTP/1.0
Host:www.joes-hardware.com

---------------------------------------
// 응답 메시지 형식
<버전> <상태 코드> <사유 구절>
<헤더>

<엔티티 본문>

// 응답 메시지 예시
HTTP/1.0 200 OK
Content-Type: image/gif
Content-Length: 8672

...

```

- `메서드`: 클라이언트에서 서버로 리소스에 대한 행위. `GET`, `HEAD`, `POST` 등이 있다.
- `요청 URL`: 요청 대상의 리소스를 지칭하는 완전한 URL 혹은 URL의 경로 구성요소.
- `버전`: 사용중인 HTTP의 버전. HTTP/<메이저>.<마이너>
- `상태 코드`: 요청 중 무엇이 일어났는지 설명하는 세 자리의 숫자.
- `사유 구절`: 상태 코드를 설명하는 짧은 문구. 상태 코드 이후 줄바꿈 전까지 사유 구절이 된다. 단순히 설며을 위한 값이다.
- `헤더들`: 이름, 콜론(:), 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더.
  - 헤더는 빈 줄(CRLF)로 끝난다.
  - HTTP/1.1 등 버전들은 특정 헤더가 포함되어야 하는 경우도 있다.
- `엔티티 본문`: 임의의 데이터 블록. 반드시 포함되어야 하는 것이 아니다.

### 3.2.2 시작줄

- HTTP 의 시작줄은 요청줄과 응답줄로 구분된다.
- 모든 시작줄의 필드는 공백으로 구분된다.
- 요청줄
  - 서버에게 리소스에 대한 무언가를 요청하는 줄.
  - 서버에게 어떠한 동작이 일어나야 하는지 알려주는 `메서드` 와
  - 동작에 대한 대상을 지칭하는 `요청 URL` 과
  - 어떤 HTTP 버전으로 말하고 있는지 `HTTP 버전`가 포함되어 있다.
- 응답줄
  - 서버에서 수행 결과에 대한 상태 정보와 결과 데이터를 반환하는 줄.
  - 응답 메시지에서 쓰인 `HTTP 버전`과
  - 숫자로 된 `상태 코드`와
  - 수행 상태에 대한 설명인 `사유 구절`이 들어있다.
- 자주 사용되는 메서드

| 메서드  | 설명                                                    | 메시지 본문 여부 |
| ------- | ------------------------------------------------------- | ---------------- |
| GET     | 서버에서 어떤 문서를 가져온다.                          | X                |
| HEAD    | 서버에서 어떤 문서에 대해 헤더만 가져온다.              | X                |
| POST    | 서버가 처리해야 할 데이터를 보낸다.                     | O                |
| PUT     | 서버에 요청 메시지의 본문을 저장한다.                   | O                |
| TRACE   | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다. | X                |
| OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다.         | X                |
| DELETE  | 서버에서 문서를 제거한다.                               | X                |

- 상태 코드

| 전체 범위 | 정의된 범위 | 분류            |
| --------- | ----------- | --------------- |
| 101 ~ 199 | 100 ~ 101   | 정보            |
| 200 ~ 299 | 200 ~ 206   | 성공            |
| 300 ~ 399 | 300 ~ 305   | 리다이렉션      |
| 400 ~ 499 | 400 ~ 415   | 클라이언트 에러 |
| 500 ~ 599 | 500 ~ 505   | 서버 에러       |

- 버전 번호
  - 버전 번호는 자신이 따르는 프로토콜 버전을 상대방에게 말해주는 것이다.
  - 즉, 현재 메시지가 HTTP/1.1 로 왔다고 해서 해당 메시지가 HTTP/1.1의 기능이 모두 쓰인 것은 아니라는 점을 주의해야 한다.
  - 요청이나 응답을 하는 애플리케이션의 HTTP버전이 1.1이라는 것이지, 메시지에 쓰인 기능이 1.1 이라는 것이 아니다.

### 3.2.3 헤더

- 헤더는 기본적으로 0개 이상이 올 수 있다.
- 헤더 필드는 이름/값 쌍으로 이루어진다.
- 헤더 분류
  - 일반 헤더: 요청과 응답 양쪽에 모두 나타날 수 있다.
  - 요청 헤더: 요청에 대한 부가 정보를 제공한다.
  - 응답 헤더: 응답에 대한 부가 정보를 제공한다.
  - Entity 헤더: 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술한다.
  - 확장 헤더: 명세에 정의되지 않은 새로운 헤더를 제공한다.
- 헤더는 이름, 쉼포, 공백(없어도 된다), 필드 값, CRLF가 순서대로 온다.
- 헤더를 여러 줄로 나누기 위해서는 추가 줄 앞에 최소 하나의 스페이스나 탭 문자가 와야 한다.

```
// 헤더의 예시
Date: Tue, 3 Oct 1997 02:16:03 GMT
Content-Type: image/gif
Accept: image/gif, image/jpeg, text/html
Server: Test Server
    Version 1.0
```

### 3.2.4 엔터티 본문

- 엔터티 본문에는 이미지, 비디오, HTML 문서 등이 올 수 있다.
- HTTP/0.9 에서는 응답 시 오직 엔터티의 본문만 보냈다.

## 3.3 메서드

### 3.3.1 안전한 메서드

- 안전한 메서드란 HTTP 요청의 결과로 서버에 어떠한 작용도 없는 메서드이다.
- 일반적으로 안전한 메서드란 'GET', 'HEAD' 메서드이다.
- 서버의 설계에 따라 안전한 메서드도 안전하지 않을 수 있지만, 안전하지 않은 메서드들이 서버에 영향을 줄 수 있다는 경고를 할 수 있다.

### 3.3.2 GET

- 서버에게 리소스를 요청할 때 사용된다.

### 3.3.3 HEAD

- GET과 비슷하게 동작하지만, 응답으로 헤더만 돌려준다.
- 리소스를 가져오지 않고, 정보를 얻을 수 있다.
- 응답의 상태 코드를 통해 개체가 존재하는지 확인할 수 있다.
- 헤더를 통해 리소스가 변경되었는지 검사할 수 있다.
- 서버 개발자는 반환되는 헤더가 GET으로 얻는 것과 일치함을 보장해야 한다.

### 3.3.4 PUT

- 서버에 문서를 쓸 때 사용된다.
- 요청 URL의 이름대로 새 문서를 만들거나, 이미 존재하는 경우 본문을 사용해서 교체한다.

### 3.3.5 POST

- POST는 입력 데이터를 전송하기 위해 설계되었다.
- POST는 데이터를 보내기 위해 사용되고, PUT은 리소스를 입력하기 위해 사용된다.

### 3.3.6 TRACE

- 목적지 서버에 도착하면서 여러 서버를 거치는 경우 HTTP 메시지가 변경될 수 있다.
- TRACE는 목적지 서버에 도착하면, 해당 메시지를 그대로 반환하여 메시지 변경 여부를 확인할 수 있다.
- 그렇기 때문에 TRACE는 일반적으로 진단을 위해 사용된다.
- TRACE안에는 어떠한 엔터티 본문도 작성할 수 없다.

### 3.3.7 OPTIONS

- 여러 가지 종류의 지원 범위에 대해 물어본다.
- 서버에게 특정 리소스에 대해 어떤 메소드(GET, POST, PUT 등)가 지원되는지 물어볼 수 있다.

### 3.3.8 DELETE

- 서버에게 요청 URL로 지정한 리소스를 삭제하도록 요청한다.
- 다만, 요청만 하는 것이기 때문에 삭제가 수행됨은 보장되지 않는다.

### 3.3.9 확장 메서드

- HTTP는 필요에 따라 확장해도 문제가 없도록 설계되어 있다.
- `LOCK`, `MKCOL`, `COPY`, `MOVE` 등의 메소드를 확장하여 사용할 수 이싿.

## 3.4 상태코드

### 3.4.1 100-199: 정보성 상태 코드

- 정보성 상태 코드는 HTTP/1.1에서 도입되었다.
- 100의 경우 서버에 엔터티를 계속해서 전송한다는 것을 의미한다.
  - 클라이언트의 경우 헤더에 100 Expect 요청 헤더를 전송하여 서버로부터 100 응답을 기대한다.
  - 서버는 100 Expect 값이 헤더에 없는 경우 100 상태코드를 전달하면 안된다.
  - 서버는 100 상태코드 전달 후 클라이언트로부터 데이터가 오기를 기다리고 있다.

| 상태코드 | 사유 구절           | 의미                                                                                                 |
| -------- | ------------------- | ---------------------------------------------------------------------------------------------------- |
| 100      | Continue            | 요청의 시작 부분 일부가 받아들였으며, 클라이언트는 나머지를 계속 이어서 보내야 한다는 것을 의미한다. |
| 101      | Switching Protocols | 클라이언트가 Upgrade 헤더에 나열한 것 중 하나로 서버가 프로토콜을 바꾸었음을 의미한다.               |

### 3.4.2 200-299: 성공 상태 코드

| 상태코드 | 사유 구절                     | 의미                                                                                                                                  |
| -------- | ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| 200      | OK                            | 요청은 정상이고, 엔터티 본문은 요청된 리소스를 포함하고 있다.                                                                         |
| 201      | Created                       | PUT 요청에 대한 응답. 생성된 리소스에 대한 최대한 구체적인 참조가 담긴 Location 헤더와 함께 리소스의 URL을 엔터티 본문에 담아야 한다. |
| 202      | Accepted                      | 요청은 받아들였지만, 아직 그에 대한 동작을 수행하지 않은 경우. 가급적 요청의 처리가 언제 될 지 정보를 포함해야 한다.                  |
| 203      | Non-Authoritative Information | 엔터티 해더가 원래 서버가 아닌 리소스의 사본에서 왔다는 것을 의미한다. 리소스의 사본만 가지고 있는 경우.                              |
| 204      | No Content                    | 엔터티 본문 없이 헤더와 상태줄만 있는 경우. 일반적으로 새 문서로 이동시키지 않고 갱신할 때 사용한다.(폼 리프레시)                     |
| 205      | Reset Content                 | 브라우저에게 현재 페이지에 있는 HTML 폼에 채워진 모든 값을 비우라는 것을 의미한다.                                                    |
| 206      | Partial Content               | 범위 요청이 성공했음을 의미한다.                                                                                                      |

### 3.4.3 300-399: 리다이렉션 상태 코드

### 3.4.4 400-499: 클라이언트 에러 상태 코드

### 3.4.5 500-599: 서버 에러 상태 코드

## 3.5 헤더

### 3.5.1 일반 헤더

- 메시지에 대한 아주 기본적인 정보를 제공한다.
- 응답 메시지나 요청 메시지에서 모두 사용할 수 있다.

### 3.5.2 요청 헤더

- 요청 메시지에서만 의미를 갖는 헤더.
- Accept 관련 헤더를 통해 서버에게 어떠한 데이터를 받을 수 있는지 전달할 수 있다.
- 조건부 요청 헤더를 통해 제약을 넣을 수 있다.
- 요청 보안 헤더를 통해 자체적으로 간단한 인증요구/응답을 할 수 있다.
- 프락시 요청 헤더를 통해 다양한 인증이나 연결을 맺을 수 있다.

### 3.5.3 응답 헤더

- 응답 메시지에서만 의미를 갖는 헤더.
- 협상 헤더를 통해 협상 가능한(범위 등) 리소스에 대한 정보를 전달할 수 있다.
- 응답 보안 헤더를 통해 인증요구/응답을 할 수 있다.

### 3.5.4 엔터티 헤더

- 요청과 응답 모두 엔터티를 포함할 수 있기 때문에, 양쪽에서 모두 사용할 수 있다.
- 일반적으로 수신자에게 자신이 다루고 있는 것이 무엇인지 말해준다.
- 콘텐츠 헤더를 통해 콘텐츠에 대한 구체적인 정보를 제공한다.
- 엔터티 캐싱 헤더를 통해 언제 어떻게 캐시가 되어야 하는지 전달할 수 있다.
