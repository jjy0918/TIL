# 1장. HTTP 개관

## 1.1 HTTP: 인터넷의 멀티미디어 배달부

- HTTP는 JPEG와 같은 이미지, HTML 페이지, 텍스트 파일, 동영상 파일 등을 웹서버로부터 사람들의 PC로 전달하는 역할을 한다.
- HTTP는 신뢰성 있는 전송을 통해 손상되거나 꼬이지 않음을 보장한다.
- 개발자는 HTTP의 신뢰성 덕분에 관련된 기능을 구현하지 않아도 된다.

## 1.2 웹 클라이언트와 서버

- WWW에서 웹 서버와 클라이언트는 보통 HTTP로 요청을 버내고, 응답을 한다.
- 인터넷 익스플로러, 구글 크롬과 같은 웹브라우저는 대표적인 클라이언트이다.
- 클라이언트가 "http://www.oreilly.com/index.html" 이라는 요청을 서버로 보내면, 서버는 해당 객체("/index.html")를 찾고 응답을 보낸다.

## 1.3 리소스

- 웹 서버는 웹 리소스를 관리하고 제공한다.
  - 웹 리소스는 일반적으로 웹 서버 파일 시스템의 정적 파일이다.
  - 텍스트 파일, HTML 파일, 워드 파일, 어도비 파일, JPEG 등이 있다.
  - 일반적으로 정적 파일일 뿐, 반드시 정적 파일일 필요는 없고 동적 파일일 수 있다.
  - 동적 파일은 사용자가 누구인지, 어떤 정보를 요청했는지 등 동적으로 다른 콘텐츠를 생성하는 것이다.

### 1.3.1 미디어 타입

- HTTP에서는 다양한 데이터 타입을 다루기 때문에 MIME 타입이라는 데이터 포맷 라벨을 붙인다.
- MIME(Multipurpose Internet Mail Extentions)이란 원래 전자 메일 시스템에서 사용되었던 타입이다.
- 웹 서버는 HTTP 객체 데이터에 MIME 타입을 붙여 전송한다.
  - `Content-type: image/jpeg`
- MIME 타입은 사선(/)으로 구분된 주 타입(Primary Object Type)과 부 타입(Specific subtype)으로 이루어져 있다.
  - HTML: text/html
  - plain ASCII: text/plain
  - JPEG: image/jpeg
  - GIF: image/gif
  - 애플 퀵타임: video/quicktime
  - 이밖에도 수백 가지의 잘 알려진 MIME 타입과 특정 용도의 MIME 타입 등이 존재한다.

### 1.3.2 URI

- URI: Uniform Resource Identifier. 통합 자원 식별자.
- 정보 리소스를 고유하게 식별하고 있는 위치를 나타내는 값
- URI는 URL과 URN이 있다.

### 1.3.3 URL

- URL(Uniform Resource Locator)
- 통합 자원 지시자.
- 특정 서버의 한 리소스에 대한 구체적인 위치.
- Ex) http://www.yahoo.com/images/logo.gif
- URL은 스킴(scheme), 인터넷 주소, 리소스 위치로 구성되어 있다.
  - 스킴: 리소스에 접근하기 위해 사용되는 프로토콜
  - http:// => 스킴, www.yahoo.com => 인터넷 주소, /images/logo.gif => 리소스 위치

### 1.3.3 URN

- URN(Uniform Resource Name)
- 콘텐츠를 이루는 한 리소스에 대해, 그 리소스의 위치에 영향 받지 않는 유일무이한 이름 역할
- URN은 리소스를 옮기더라도 문제 없이 동작한다.
- 실험 중인 상태이고, 아직 널리 채택되지 않았다.
- 리소스 위치를 분석하기 위한 인프라가 필요하다.

## 1.4 트랜잭션

- HTTP의 트랜잭션은 요청 명령(클라이언트 -> 서버)과 응답 결과(서버 -> 클라이언트)로 구성되어 있다.
- 이러한 상호작용은 HTTP 메시지라는 데이터 덩어리를 이용해 이루어진다.

### 1.4.1 메서드

- 모든 HTTP 요청 메시지는 한 개의 메서드를 갖는다.
- 메서드를 통해 서버는 어떤 동작을 취해야 하는지 알 수 있다.
- GET: 서버에서 클라이언트로 지정한 리소스를 보내라.
- PUT: 클라이언트에서 서버로 보낸 데이터를 지정한 이름의 리소스로 저장하라.
- DELETE: 지정한 리소스를 서버에서 삭제하라.
- POST: 클라이언트 데이터를 서버 게이트웨이 애플리케이션으로 보내라.
- HEAD: 지정한 리소스에 대한 응답에서, HTTP 헤더 부분만 보내라.

### 1.4.2 상태 코드

- HTTP 요청에서는 상태 코드를 통해 요청이 성공했는지, 아니면 추가 조치가 필요한지 확인이 가능하다.
- 200: 좋다. 문서가 바르게 반환되었다.
- 302: 다시 보내라. 다른 곳에 가서 리소스를 가져가라.
- 404: 없음. 리소스를 찾을 수 없다.
- HTTP는 상태 코드와 함께 사유 구절(reason phrase)도 같이 보낸다. 다만, 설명만을 위해 포함된 것이기 때문에 응답 처리에 사용되지는 않는다.

### 1.4.3 웹페이지는 여러 객체로 이루어질 수 있다.

- 웹 페이지는 여러 트랜잭션을 통해 구현된다.
- HTML로 뼈대를 가져온 후 이미지, 그래픽 조각, 자파 애플릿 등을 가져온다.

## 1.5 메시지

- HTTP의 메시지 요청 메시지와 응답 메시지가 있다.
- 요청 메시지
  - 클라이언트 -> 서버
- 응답 메시지
  - 서버 -> 클라이언트
- 시작줄: 메시지 첫 줄은 항상 시작줄이다. 요청이라면 무엇을 해야 하는지, 응답이라면 무슨 일이 일어났는지 나타낸다.
- 헤더: 시작줄 다음에 0개 이상의 헤더 필드가 이어진다.
  - 각 헤더 필드는 쌍점(:)으로 구분되어 이름과 값으로 구성되어 있다.
  - 헤더는 빈 줄로 끝난다.
- 본문: 본문은 시작줄이나 헤더와 달리 텍스트뿐만 아니라 이진 데이터도 포함할 수 있다.

### 1.5.1 간단한 메시지의 예

```
요청 메시지
GET /tools.html HTTP/1.0                    // 시작줄
User-agent: Mozilla/4.75 [en] (Win98; U)    // 헤더 시작
HOST: www.joe-hardware.com
Accept: text/html, image/gif, image/jpeg
Accept-language: en
                                            // 헤더 종료

-----------------------------------------------------------
응답 메시지
HTTP/1.0 200 OK                             // 시작줄
Date: Sun, 01 Oct 2000 23:25:17 GMT         // 헤더 시작
Server: Apache/1.3.11 BSafe-SSL/1.38 (Unix)
Last-modified: Tue, 04 Jul 2000 09:46:21 GMT
Content-length: 403
Context-type: text/html
                                            // 헤더 종료
<HTML>                                      // 본문 시작
<HEAD> ~~~ </HEAD>
<BODY>
~~~
</BODY>
</HTML>                                     // 본문 종료

```

## 1.6 TCP 커넥션

### 1.6.1 TCP/IP

- HTTP는 애플리케이션 계층의 프로토콜이다.
- HTTP는 TCP를 사용한다.
  - TCP는 오류 없는 데이터를 전송할 수 있다.
  - TCP는 순서에 맞는 전달을 한다.(데이터는 언제나 보낸 순서대로 도착한다.)
  - TCP는 조각나지 않는 데이터 스트림을 보장한다.(언제든 어떤 크기로든 보낼 수 있다.)
- TCP를 통한 전송을 하기 때문에 메시지 유실이나, 손상, 순서의 뒤바뀜 등의 일이 없다.

### 1.6.2 접속, IP 주소 그리고 포트번호

- HTTP 메시지 전송 전 TCP/IP 커넥션을 맺어야 한다.
- TCP/IP 커넥션을 맺기 위해서는 IP주소와 포트 번호가 필요하다.
- IP주소와 포트 번호는 URL을 통해 알 수 있다.
- HTTP는 기본 포트로 80을 사용한다.
- HTML 리소스를 보여주는 순서
  1. 웹브라우저는 서버의 URL에서 호스트 명을 추출한다.
  2. 웹브라우저는 서버의 호스트 명을 IP로 변환한다.
  3. 웹브라우저는 URL에서 포트번호(있다면)를 추출한다.
  4. 웹브라우저는 웹 서버와 TCP 커넥션을 맺는다.
  5. 웹브라우저는 서버에 HTTP 요청을 보낸다.
  6. 서버는 웹브라우저에 HTTP 응답을 돌려준다.
  7. 커넥션이 닫히면, 웹브라우저는 문서를 보여준다.

## 1.7 프로토콜 버전

- HTTP 프로토콜은 여러 버전이 존재한다.
- HTTP/0.9
  - 오직 GET 메서드만 지원한다.
  - 멀티미디어 콘텐츠에 대한 MIME 타입, HTTP 헤더, 버전 번호를 지원하지 않는다.
- HTTP/1.0
  - 버전 번호, HTTP 헤더, 추가 메서드, 멀티미디어 객체 처리를 지원하기 시작했다.
- HTTP/1.0+
  - keep-live 커넥션, 가상 호스팅 지원, 프롹시 연결 등을 지원하기 시작했다.
- HTTP/1.1
  - HTTP의 구조적 결함 교정, 성능 최적화, 잘못된 기능 제거 등을 했다.
- HTTP/2.0
  - HTTP/1.1의 성능 문제를 개선

## 1.8 웹의 구성 요소

### 1.8.1 프락시

- 클라이언트와 서버 사이에 위치한다.
- 클라이언트의 모든 HTTP 요청을 받아 서버로 전달하는 역할을 한다.
- 프락시는 주로 보안을 위해 사용된다.
- 요청과 응답을 필터링한다.

### 1.8.2 캐시

- 웹캐시와 캐시 프락시는 자신을 거쳐하는 문서 중 자주 찾는 것의 사본을 저장해 두는 특별한 프락시 서버다.
- 캐시에 저장된 후 클라이언트가 같은 데이터를 요청하면, 캐시가 가지고 있는 사본을 전달한다.
- 웹 서버보다 더 빨리 데이터를 전달할 수 있다.
- HTTP는 캐시를 효율적으로 동작하게 하고, 캐시된 콘텐츠를 최신 버전으로 유지하면서 프라이버시도 보호하기 위한 많은 기능을 정의한다.

### 1.8.3 게이트웨이

- 다른 서버들의 중개자로 동작하는 특별한 서버.
- 주로 HTTP 트래픽을 다른 프로토콜로 변환하기 위해 사용된다.
- ex) HTTP/FTP 게이트웨이는 FTP URI에 대한 HTTP 요청을 받아들인 후, FTP 프로토콜을 이용해 문서를 가져온다.

### 1.8.4 터널

- 두 커넥션 상에서 raw 데이터를 열어보지 않고 그대로 전달해준다.
- HTTP 터널은 비 HTTP 데이터를 하나 이상의 HTTP 이상의 연결을 통해 그대로 전행주기 위해 사용된다.

### 1.8.5 에이전트

- 사용자 에이전트는 사용자를 위해 HTTP 요청을 만들어주는 클라이언트 프로그램
