# 14 리펙터링 - 기존의 코드를 성장시키는 기술

## 14.1 리펙터링의 흐름

- 리펙터링이란 실질적인 동작은 유지하면서, 구조만 정리하는 작업을 의미한다.
  - 리펙터링을 하면서 실질적인 동작까지 바뀌어 버린다면, 리펙터링이라 할 수 없다.
  - 리펙터링 중 실질적인 동작이 변하지 않았음을 확인할 수 있는 방법으로는 단위 테스트가 있다.
- 중첩을 제거하여 보기 좋게 만들기
- 의미 단위로 로직 정리하기
  - 서로 다른 일이 뒤섞여 있는 경우 의미 단위로 로직을 분리한다.
  - ex) 조건 확인 로직과 값 대입 로직을 각각 분리한다.
- 조건을 읽기 쉽게 하기
  - 조건 중 논리 부정 연산자(!)를 사용하는 경우 가독성이 조금 떨어지기 때문에 별도의 메소드를 만드는 것이 좋다.
- 무턱대고 작성한 로직을 목적을 나타내는 메서드로 바꾸기
  - ex) if(customer.possessionPoint.amount < comit.currentPurchasePoint.amout) --> isShortOfPoint 메서드로 변경

## 14.2 단위 테스트로 리팩터링 중 실수 방지하기

- 실수를 줄일 수 있는 가장 확실한 방법은 단위 테스트를 사용하는 것이다.
  - 단위 테스트는 작은 기능 단위로 동작을 검증하는 테스트를 의미한다.
- 리펙터링과 단위 테스트는 항상 세트라고 생각하면 된다.

### 테스트 코드를 사용한 리펙터링 흐름

1. 이상적인 구조의 클래스 기본 형태를 어느 정도 잡는다.
2. 이 기본 형태를 기반으로 테스트 코드를 작성한다.
3. 테스트를 실패시킨다.
4. 테스트를 성공시키기 위한 최소한의 코드를 작성한다.
5. 기본 형태의 클래스 내부에서 리펙터링 대상 코드를 호출한다.
6. 테스트가 성공할 수 있도록, 조금씩 로직을 이상적인 구조로 리펙터링한다.

## 14.3 불확실한 사양을 이해하기 위한 분석 방법

- 테스트 코드가 없고 사양을 제대로 모른다면 리펙터링하기 어려워진다.
- 사양을 모를 때 리펙터링할 수 있는 테크닉 2가지가 있다.

### 문서화 테스트

- 문서화 테스트는 메서드의 사양을 분석하는 방법이다.
- 메서드의 매개변수에 따라 어떠한 값이 리턴되는지 확인하여 해당 메서드의 동작을 확인한다.
- 실제 동작 자체를 완벽하게 알기는 어렵지만, 어떠한 유스케이스에서 호출되는지 등 복합적으로 분석하면서 조금이나마 명확하게 만들 수 있다.
- 음..

### 스크래치 리펙터링

- 스크래치 리펙터링이란 정식 리펙터링이 아니라 로직의 의미과 구조를 분석하기 위해 시험 삼아 하는 리펙터링을 말한다.
- 테스트 코드 작성을 하지 않고 리펙터링을 한 후 로직 사양이나 구조를 파악하여 이상적인 구조를 떠올릴 수 있게 된다.
  - 이상적인 구조를 바탕으로 테스트 코드를 작성하고, 실제 리펙터링을 진행한다.
- 스크래치 리펙터링은 분석용이기 때문에 역할을 마쳤다면 파기해야 한다.

## 14.4 IDE의 리펙터링 기능

- IDE에서 이름 변경, 메서드 추출 등 편리하게 리펙터링 기능을 제공한다.

## 14.5 리펙터링 시 주의 사항

- 기능 추가와 리펙터링 동시에 하지 않기
  - 둘 중 한쪽만 집중해야 한다.
- 작은 단계로 실시하기
  - 리펙터링은 작은 단계로 실시하는 것이 좋다.
  - 커밋은 어떻게 리펙터링 했는지 차이를 알 수 있는 단위로 한다.
- 불필요한 사양은 제거 고려하기
  - 코드에 버그가 있거나 다른 사양과 모순되는 점이 있다면 리펙터링해도 바로 잡기 힘들다.
  - 이익에 거의 기여하지 않는 불필요한 사양은 제거하는 것이 좋다.