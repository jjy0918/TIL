# 4 불변 활용하기 - 안정적으로 동작하게 만들기

- 변수의 상태를 변경할 수 있으면 `가변(mutable)`이라고 하며, 변경할 수 없다면 `불변(immutable)`이라고 한다.
- 가변 변수는 동작을 예측하기 어렵고 혼란스럽게 만들 수 있다.
- 불변 변수를 사용하면 이러한 불편함이 없어진다.

## 4.1 재할당

- 이미 값이 설정된 변수에 값을 다시 할당하는 것을 `재할당` 또는 `파괴적 할당` 이라고 한다.
- 재할당은 변수의 의미를 바꾸고 추축하기 어렵게 만들기 때문에 피하는 것이 좋다.

### 4.1.1 불변 변수로 만들어서 재할당 막기

- 불변 변수로 만들기 위해서 가장 간단한 방법이 `final` 수식자를 붙이는 것이다.
- final 을 붙인 변수를 재할당 하려 하면 컴파일 에러가 발생하기 때문에 기계적으로 막을 수 있다.

### 4.1.2 매개변수도 불변으로 만들기

- 매개변수도 의미가 변경될 수 있기 때문에 final을 붙여서 불변으로 만드는 것이 좋다.

## 4.2 가변으로 인해 발생하는 의도하지 않은 영향

- 인스턴스가 가변인 경우에는 의도하지 않은 영향을 줄 수 있다.
- 함수의 부수효과에 의해 가변인 변수들은 예상하지 못한 결과를 반환하기 떄문에 불변으로 선언하는 것이 좋다.
  - 함수의 부수효과란 매개변수를 전달받아 리턴하는 것 외에 외부 상태를 변경하는 것을 말한다.
- 부수효과가 있는 함수는 영향 범위를 예측하기 어렵기 때문에 범위를 한정하는 것이 좋다.
  - 데이터(상태)는 매개변수로 받는다.
  - 상태를 변경하지 않는다.
  - 값은 함수의 리턴 값으로 돌려준다.
- 가변적인 변수와 부수적인 효과가 발생하는 메소드를 단순히 조심해서 사용하면 괜찮다는 안일한 생각은 더욱 큰 악마를 불러들인다.
  - 이를 막기 위해 가장 간단하면서 효과적인 방법이 인스턴스 변수에 final을 붙여 불변으로 만드는 것이다.
- 불변 변수를 변경하고 싶다면, 값을 변경하는 것이 아니라 새로운 값을 가진 인스턴스 변수를 만들면 된다.

## 4.3 불변과 가변은 어떻게 다루어야 할까

- 변수는 기본적으로 불변 상태로 만드는 것이 좋으며, 불변으로 만들면 여러가지 장점이 있다.
  - 변수의 의미가 변하지 않으므로, 혼란을 줄일 수 있다.
  - 동작이 안정적이게 되므로, 결과를 예측하기 쉽다.
  - 코드의 영향 범위가 한정적이므로, 유지 보수가 편리해진다.
- 성능때문에 가변으로 설계해야 하는 경우도 존재한다.
  - 불변의 경우 매번 새로운 인스턴스를 만들어주어야 하기 때문에 크기가 크다면 성능상 문제가 발생할 수 있다.
  - 성능상 문제가 발생할 것으로 우려된다면 스코프가 국소적인 경우에만 가변으로 사용하는 것이 좋다.
- 인스턴스를 가변 변수로 설계했다면, 상태를 변화시기키는 `뮤테이터(mutater)` 메소드를 사용하는 것이 좋다.
- 코드 외부의 데이터는 동작 예측이 힘들기 때문에 각별히 주의가 필요하다.