# Chapter18 함수형 관점으로 생각하기

## 18.1 시스템 구현과 유지보수

### 공유된 가변 데이터

- 변수가 예상하지 못하는 값을 가지는 이유는 가변 데이터를 여러 메서드에서 읽고 수정하기 떄문이다.
  - 변수가 다른 메서드에서 변경되지 않음을 현재 메서드에서 보장하지 못하기 떄문에 예상하지 못하는 값을 가지게 된다.
- 자신을 포함하는 클래스의 상태와 다른 객체의 상태를 바꾸지 않으면서 return 문을 통해서만 결과를 반환하는 메서드를 `순수` 메서드 또는 `부작용 없는` 메서들 ㅏ고 한다.
  - 부작용이란 함수 내에서 포함되지 못한 기능을 말한다.
  - ex) 필드 값 변경, 예외, I/O 등
- 불변 객체를 이용하면 부작용을 줄일 수 있다.
- 부작용이 없는 시스템은 메서드가 서로에게 간섭을 하지 않기 떄문에 잠금(lock)을 사용하지 않더라도 병렬성을 안전하게 사용할 수 있다.
- 부작용 시스템 개념은 함수형 프로그래밍에서 유래되었으며, 이는 선언형 프로그래밍으로 발전했다.

### 선언형 프로그래밍

- 프로그래밍 방식은 크게 명령형과 선언형으로 구분할 수 있다.
- 명령형 프로그래밍은 `어떻게`에 집중하는 고전적인 객체지향 프로그래밍 방식이다.
- 선언형 프로그래밍은 `무엇을`에 집중하는 프로그래밍 방식이다.
  - 선언형 프로그래밍 방식은 우리가 원하는 것이 무엇이고, 시스템에서는 그 목표를 어떻게 달성할 것인지 정의한다.

## 18.2 함수형 프로그래밍이란 무엇인가?

- 함수형 프로그래밍은 한 개 이상의 결과를 반환하지만, 부작용이 없어야 한다.
- 함수형 프로그래밍에서 함수는 수학적 함수와 유사하다.
- 인수가 같다면 같은 값을 리턴해야 한다.

### 함수형 자바

- 자바에서는 완벽히 순수 함수형 프로그래밍을 구현하기는 어렵다.
- 하지만 시스템 컴포넌트가 순수한 함수형인 것처럼 동작하도록 코드를 구현할 수는 있다.
- 실제 부작용이 있지만 아무도 이를 보지 못하게 함으로써 함수형을 달성할 수 있다.
  - 해당 메서드만으로는 부작용이 없지만, 다른 메서드와 엮이면서 부작용이 생긴다면 함수형이 아니다.
- 함수나 메서드는 지역 변수만을 변경해야 함수형이라 할 수 있다.
- 함수나 메서드에서 객체를 참조할 때 그 객체는 불변이어야 한다.
  - 예외적으로 메서드 내에서 생성한 객체는 메서드 내에서 변경할 수 있다.
  - 그 객체의 필드는 외부에서 노출되면 안되며, 다음에 메서드를 다시 호출한 결과에 영향을 미치지 않아야 한다.
- 함수형이라면 함수나 메서드가 어떤 예외도 일으키지 않아야 한다.
  - 예외를 발생시키는 대신 Optional등을 이용하여 값이 비정상적임을 표현하자.

### 참조 투명성

- 부작용을 감춰야 한다라는 제약은 참조 투명성 개념으로 귀결된다.
  - 즉, 같은 인수로 함수를 호출했을 때 항상 같은 결과를 반환한다.
- 함수는 어떠한 입력이 주어졌을 때 언제, 어디서 호출하든 같은 결과를 생성해야 한다.
- 자바에서 객체를 반환했을 때 그 객체가 가변 객체라면 같은 값을 가지는 것이 아니기 떄문에 참조 투명성에 위반된다 할 수 있지만, 불변 객체라면 주소가 다르더라도 값이 같기 때문에 참조 투명한 것으로 간주한다.
