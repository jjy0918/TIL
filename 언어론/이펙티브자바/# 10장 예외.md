# 10장 예외

## 아이템 69. 예외는 진짜 예외 상황에만 사용하라

- 예외는 오직 예외 상황에서만 써야 한다. 절대로 일상적인 제어 흐름용으로 쓰여선 안 된다.
- 잘 설계된 API라면 클라이언트가 정상적인 제어 흐름에서 예외를 사용할 일이 없게 해야 한다.

## 아이템 70. 복구할 수 있는 상황에서는 검사 예외를 프로그래밍 오류에는 런타임 예외를 사용하라.

- 호출하는 쪽에서 복구하리라 여겨지는 상황이라면 검사 예외(checked exception)를 사용하라.
  - 검사 예외를 던지면 호출하는 측에서 catch로 잡거나 더 바깥으로 전파하도록 강제하게 된다.
  - API 설계자는 API 사용자에게 검사 예외를 던져주어 그 상황에서 회복해내라고 요구하게 된다.
- 프로그래밍 오류를 나태낼 때는 런타임 예외를 사용하자.
  - 런타임 예외의 대부분은 전제조건을 만족하지 못했을 때 발생한다.
- unchecked throwable은 모두 RuntimeException의 하위 클래스여야 한다.
- Error는 상속하지 말아야 하며, throw 문으로 직접 던지는 일도 없어야 한다.
- Exception, Error를 상속하지 않는 throwable을 만들 수 있지만, 하면 안된다.
- checked exception은 일반적으로 복구할 수 있는 조건일 때 발생한다.
  - 예외 상황에서 벗어나는 데 필요한 정보를 알려주는 메서드를 함께 제공하는 것이 중요하다.

## 아이템 71. 필요 없는 검사 예외 사용은 피하라.

- 검사 예외는 발생한 문제를 프로그래머가 처리하여 안전성을 높이게끔 해준다.
- 하지만, 검사 예외를 과하게 사용하면 오히려 쓰기 불편한 API가 된다.
- 검사 예외가 던져질 수 있다고 선언되었다면, 이를 호출하는 코드에서는 catch 블록을 두어 예외를 붙잡거나 던져야 한다.
  - 어느쪽이든 API 사용자에게 부담을 준다.
  - 검사 예외를 던지는 것은 스트림에서 불가능하기 떄문에 자바 8부터는 더욱 부담이 커졌다.
- 검사 예외를 피하는 가장 쉬운 방법은 적절한 결과 타입을 담은 옵셔널을 반환하는 것이다.
  - 검사 예외를 던지는 대신 빈 옵셔널을 반환하면 된다.
  - 다만, 예외가 발생한 이유를 알려준느 부가 정보를 담을 수 없다.
- 예외가 던져질 여부를 boolean 값으로 반환하는 것도 좋다.
  - 예외가 발생하지 않고 정상 동작하는 경우 true
  - 예외가 발생한 경우 false

## 아이템 72. 표준 예외를 사용하라.

- 자바 라이브러리에서는 대부분 API에서 쓰기에 충분한 수의 예외를 제공한다.
- 표준 예외를 사용할 경우 다른 사람이 익히고 사용하기 편해진다.
- Exception, RuntimeException, Throwable, Error는 직접 재사용하지 말자.
- 인수 값이 무엇이었든 어차피 실패했을 거라면 IllegalStateException을, 그렇지 않으면 IllegalArgumentException을 던지자.

## 아이템 73. 추상화 수준에 맞는 예외를 던지라.

- 상위 계층에서는 저수준 예외를 잡아 자신의 추상화 수준에 맞는 예외로 바꿔 던져야 한다.
- 저수준 예외가 디버깅에 도움이 된다면, 예외 연쇄(exception chaining)를 사용하는 것이 좋다.
- 무턱대고 예외를 전파하는 겁소다야 예외 번역이 우수하지만, 그렇다고 남용해서는 곤란하다.

## 아이템 74. 메서드가 던지는 모든 예외를 문서화하라.

- 메서드가 던지는 예외 하나하나를 문서화하는 데 충분한 시간을 쏟아야 한다.
- 검사 예외는 항상 따로따로 선언하고, 각 예외가 발생하는 상황을 자바독의 @throws 태그를 사용하여 정확히 문서화하자.
  - 공통 상위 클래스 하나로 뭉뜽그려 선언하는 일은 삼가자.
  - Exception이나 Throwable을 던진하고 선언해서는 안된다.
  - main 메서드만 Exception을 던져지도록 선언해도 좋다.
- 비검사 예외도 검사 예외처럼 정성껏 문서화하면 좋다.
  - public 메서드라면 필요한 전제조건을 문서화해야 하기 때문에 비검사 예외들도 문서화하면 좋다.
  - 발생 가능한 비검사 예외를 문서로 남기는 일은 인터페이스에서 특히 중요하다.
- 메서드가 던질 수 있는 예외들을 @throws 태그로 문서화는 하지만, 비검사 예외는 throws로 던지면 안된다.
- 한 클래스에 많은 메서드가 같은 이유로 예외를 던진다면 클래스 설명에 추가해도 좋다.

## 아이템 75. 예외의 상세 메시지에 실패 관련 정보를 담으라.

- 예외의 toString 메서드의 실패 원인에 관한 정보를 가능한 한 많이 담아 반환하는 일은 아주 중요하다.
- 실패 순간을 포착하려면 발생한 예외에 관여된 모든 매개변수와 필드의 값을 실패 메시지에 담아야 한다.
- 상세 메시지에 비밀번호나 암호 키 값은 정보까지 담아서는 안 된다.
- 예외의 메시지와 최종 사용자에게 보여줄 메시지는 다르다.
  - 예외의 메시지는 가독성 보다는 담긴 내용이 훨씬 중요하다.
  - 최종 사용자에게는 가독성이 중요하다.

## 아이템 76. 가능한 한 실패 원자적으로 만들라.

- 호출된 메서드가 실패하더라도 해당 객체는 메서드 호출 전 상태를 유지해야 한다.
- 메서드를 실패 원자적으로 만드는 가장 좋은 방법은 불변 객체로 설계하는 것이다.
- 가변 객체의 경우 매개변수의 유효성을 검사하는 방법이 가장 좋다.
- 실패할 가능성이 있는 모든 코드를 객체의 상태를 바꾸는 코드보다 앞에 배치해도 좋다.
- 객체의 임시 복사본에서 작업을 수행한 다음 작업이 성공적으로 완료되면 원래 객체와 교체하는 것도 좋다.
- 작업 도중 발생하는 실패를 가로채는 복구 코드를 작성하여 작업 전 상태로 되돌리는 방법도 좋다.

## 아이템 77. 예외를 무시하지 말라

- 예외를 무시하지 말라.
- 예외를 무시하려면(catch 블록을 비워두는 경우) 그렇게 결정한 이유를 주석으로 남기고 예외 변수의 이름도 ignored로 바꿔라.
