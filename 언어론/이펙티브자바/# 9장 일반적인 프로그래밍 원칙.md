# 9장 일반적인 프로그래밍 원칙

## 아이템 57. 지역변수의 범위를 최소화하라.

- 지역변수의 유효 범위를 최소로 줄이면 코드 가독성과 유지보수성이 높아지고 오류 가능성은 낮아진다.

### 지역변수 유효 범위 최소화 방법

- 자바에서는 지역변수를 어디서든 선언할 수 있기 때문에, 처음 쓰일 때 선언하는 것이 좋다.
  - C처럼 코드 블록의 첫 머리에 선언하게 되면 코드가 어수선해지고 가독성이 떨어진다.
- 지역변수는 선언과 동시에 초기화 하는 것이 좋다.
  - 초기화에 필요한 정보가 충분하지 않다면 충분해질 때까지 선언을 미루는 것이 좋다.
  - try ~ catch에서는 초기화하는 부분에서 검사 예외를 던질 수 있기 때문에 예외다.
- 반복분에서 반복 변수의 값을 반복문이 종료된 뒤에 써야 하는 것이 아니라면 while보다는 for문을 쓰자.
  - for문은 while문과 달리 원소에 대한 오류를 최소화할 수 있다.
  - for문은 변수 유효 범위가 for 문과 일치하기 때문에 똑같은 이름을 여러 반복문에서 쓸 수 있다.
  - for문은 while문 보다 가독성이 좋다.
- 메서드를 작게 유지하고, 한 가지 기능에 집중하라.
  - 메서드가 여러 기능을 가지고 있다면, 한 기능과 관련된 지역변수가 다른 기능을 수행하는 코드에 접근하여 문제가 발생할 수 있다.

## 아이템 58. 전통적인 for 문보다는 for-each 문을 사용하라.

- 인덱스나 Iterator를 이용한 for 문 순회는 코드를 지저분하게 만든다.
- for-each 문은 코드를 간단하게 만들어주고, 잘못된 변수에 대한 오류 발생을 저지할 수 있다.
- for-each는 배열이나 컬렉션 모두 처리할 수 있기 때문에 어떠한 컨테이너를 다루는지는 신경 쓰지 않아도 된다.
- 컬렉션 중첩 순회 시 for-each 문의 이점이 더욱 커진다.
- for-each 문을 사용할 수 없는 상황
  - 파괴적인 필터링(destructive filtering): 컬렉션 순회 시 선택된 원소를 제거해야 하는 경우
  - 변형(transforming): 리스트나 배열을 순회하면서 그 원소의 값 일부 혹은 전체를 교체하는 경우
  - 병렬 반복(paralle iteration): 여러 컬렉션을 병렬로 순회하는 경우
- for-each 문은 `Iterable` 인터페이스를 구현한 객체라면 모두 사용 가능하다.

## 아이템 59. 라이브러리를 익히고 사용하라.

- 표준 라이브러리를 사용하면, 그 코드를 작성한 전문가의 지식과 다른 프로그래머들의 경험을 활용할 수 있다.
- 표준 라이브러리를 사용하면 핵심적인 일과 크게 관련 없는 문제를 해결하느라 시간을 허비하지 않아도 된다.
- 표준 라이브러리는 따로 노력하지 않아도 성능이 지속해서 개선된다.
- 표준 라이브러리는 기능이 점점 많아진다.
- 표준 라이브러리를 사용함에 따라 많은 사람들에게 낯익는 코드가 될 수 있다.

## 아이템 60. 정확한 답이 필요하다면 float과 double은 피하라.

- float과 double은 이진 부동소수점 연산에 쓰이며 넓은 범위의 수를 근사치로 계산하기 떄문에 정확한 계산과 맞지 않을 수 있다.
- 특히 금융계산에서는 float이나 double보다는 `BigDecimal`, `Int`, `long`을 사용하자.

## 아이템 61. 박싱된 기본 타입보다는 기본 타입을 사용하라.

- 자바의 타입은 기본 타입과 참조 타입으로 나뉜다.
- 기본 타입은 각각 대응되는 참조 타입을 가지고 있으며, 이를 박싱된 기본 타입이라고 한다.
- 박싱된 기본 타입은 기본 타입과 주된 차이점 3가지를 가지고 있다.
  - 기본 타입은 값만 가지고 있지만, 박싱된 기본 타입은 값과 식별성을 가지고 있다.
    - 두 인스턴스가 값은 같아도 다르다고 식별될 수 있다.
    - == 연산자를 이용할 경우 다르게 식별된다.
  - 기본 타입의 값은 언제나 유효하지만, 박싱된 기본 타입은 null을 가질 수 있다.
  - 기본 타입이 박싱된 기본 타입보다 시간과 메모리 사용면에서 더 효율적이다.
- 기본 타입과 박싱된 기본 타입 연산 시 자동으로 오토 박싱이 일어나기 때문에 주의가 필요하다
- 박싱된 기본 타입은 컬렉션과 같이 매개변수화 타입이나 메서드에서만 사용하거나 리플렉션을 통해 메서드 호출할 때만 사용하는 것이 좋다.

## 아이템 62. 다른 타입이 적절하다면 문자열 사용을 피하라

- 문자열을 사용하여 다른 값 타입을 대신하기에는 적절하지 않다.
- 문자열은 열거 타입을 대신하기에 적합하지 않다.
- 문자열은 혼합 타입을 대신하기에 적합하지 않다.
- 문자열은 권한을 표현하기에 적합하지 않다.

## 아이템 63. 문자열 연결은 느리니 주의하라.

- 문자열 연결 연산자로 문자열 n개를 잇는 시간은 n^2에 비례한다.
- 문자열은 불변이라서 두 문자열 연결 시 양쪽의 내용을 모두 복사해야 하기 때문에 성능 저하가 발생한다.
- 성능 향상이 필요하다면 String 대신 StringBuilder를 사용하자.
- 문자열 연결 연산은 JDK 1.5부터 자동으로 StringBuilder로 치환되고 있다.
  - https://stackoverflow.com/questions/1532461/stringbuilder-vs-string-concatenation-in-tostring-in-java
  - https://gist.github.com/benelog/b81b4434fb8f2220cd0e900be1634753
- JDK9 부터는 좀 더 효율적으로 컴파일 시켜준다
  - https://stackoverflow.com/questions/46512888/how-is-string-concatenation-implemented-in-java-9
  - https://openjdk.org/jeps/280
- for문과 같이 반복문에 += 를 사용할 경우 컴파일러가 대응을 못하기 때문에 비효율적이다.

```java
String s = "";
for(int i=0; i<100; i++) {
  s += "A"; // 컴파일러가 StringBuilder로 치환 불가능
}
```

## 아이템 64. 객체는 인터페이스를 사용해 참조하라.

- 적합한 인터페이스가 있다면, 매개변수뿐 아니라 반환값, 변수, 필드를 전부 인터페이스 타입으로 선언하라.
- 인터페이스를 타입으로 사용하는 습관을 길러두면 프로그램이 훨씬 유연해질 것이다.
- 인터페이스로 선언함에 따라 새로운 객체로 교체도 쉽다.
- 적합한 인터페이스가 없다면 당연히 클래스로 참조해야 한다.
  - 특수한 경우가 아니라면, 적합한 인터페이스가 없을 떄 클래스의 계층구조 중 필요한 기능을 만족하는 가장 덜 구체적인 클래스 타입으로 사용하자.

## 아이템 65. 리플렉션보다는 인터페이스를 사용하라.

- 리플렉션을 이용하면 프로그램에서 임의의 클래스에 접근할 수 있다.
- 리플렉션을 이용하면 컴파일타임 타입 검사의 이점을 누릴 수 없고, 코드가 지저분해지고, 성능도 떨어진다.
- 리플렉션은 아주 제한된 형태로만 사용해야 단점은 피하면서 이점만 취할 수 있다.
- 리플렉션은 인스턴스 생성에만 쓰이고, 생성한 인스턴스는 인터페이스나 상위 클래스로 참조해 사용하자.

## 아이템 66. 네이티브 메서드는 신중히 사용하라.

- 자바 네이티브 인터페이스(Java Native Interface, JNI)는 자바 프로그램이 네이티브 메서드를 호출할 수 있게 해준다.
  - 네이티브 메서드란 C, C++ 같은 네이티브 프로그래밍 언어로 작성한 메서드를 말한다.

### 네이트브 메서드의 주요 쓰임은 3가지

1. 레지스트리 같은 플랫폼 특화 기능을 사용할 때
   - 자바는 OS 등의 하부 플랫폼 기능을 점차 흡수하고 있기 때문에 사용할 필요가 거의 없다.
   - 자바9에서는 process API를 제공하기 때문에 OS 프로세스에 접근할 수 있게 해준다.
2. 네이티브 코드로 작성된 기존 라이브러리를 사용할 때
3. 성능 개선을 위해
   - 일반적으로 성능 개선을 위해 네이티브 메서드를 사용하는 것은 권장되지 않는다.
   - JVM은 엄청난 속도로 발전했기 때문에 충분하다.
   - 고성능 다중 절밀 연산(GMP)이 필요한 경우에만 네이티브 메서드를 통해 GMP를 사용하는 것을 고려해라.

### 네이티브 메서드 단점

- 네이티브 언어(C, C++)은 안전하지 않기 때문에 네이티브 메서드도 위험할 가능성이 있다.
- 네이티브 언어는 플랫폼을 많이 타서 이식성도 낮다.
- 주의하지 않으면 오히려 속도가 더 느려질 수 있다.
- 가비지 컬렉터는 네이티브 메모리를 자동 회수하지 않기 때문에 주의가 필요하다.
- 자바 코드와 네이티브 코드의 경계를 넘나들 때마다 비용이 추가된다.
- 네이티브 메서드와 자바 코드 사이의 접착 코드(glue code)를 작성해야 하는데, 이는 귀찮고 가독성도 떨어진다.

### 핵심 정리

- 네이티브 메서드를 사용하려거든 한번 더 생각하라.
- 네이티브 메서드가 성능을 개선해주는 일은 많지 않다.
- 저수준 자원이나 네이티브 라이브러리를 사용해야만 해서 어쩔 수 없더라도 네이티브 코드는 최소한만 사용하고 철저히 테스트하라.

## 아이템67. 최적화는 신중히 하라.

- 최적화는 좋은 결과보다는 해로운 결과로 이어지기 쉽다.
- 성능 때문에 견고한 구조를 희생하지 말자.
- 빠른 프로그램보다는 좋은 프로그램을 작성하라.
- 구현상의 문제는 나중에 최적화해 해결할 수 있지만, 아키텍처의 결함은 성능을 제한하는 상황이라면 구조 변경이 쉽지 않다.
  - 설계 단계에서 성능을 반드시 염두에 두어야 한다.
- 성능을 제한하는 설계는 반드시 피해야 한다.
- API를 설계할 때 성능에 주는 영향을 고려하라.
- 성능을 위해 API를 왜곡하는 건 매우 안 좋은 생각이다.
- 최적화는 신중하게 설계하여 깨끗하고 명확한 멋진 구조를 갖춘 프로그램을 완성한 후 고려하면 된다.
- 최적화 시도 전후로 성능을 측정하라.

## 아이템 68. 일반적으로 통용되는 명명 규칙을 따르라.

- 자바 플랫폼은 명명 규칙이 잘 정립되어 있다.
- 자바의 명명 규칙은 크게 철자와 문법 두 범주로 나뉜다.

### 철자 규칙

- 철자 규칙은 패키지, 클래스, 인터페이스, 메서드, 필드, 타입 변수의 이름을 다룬다.
- 패키지와 모듈은 각 요수를 점(.)으로 구분하여 계층적으로 짓는다.
  - 요소들은 모두 소문자 알파벳 혹은 (드물게)숫자로 이루어진다.
  - 패키지 이름은 해당 패키지를 설명하는 하나 이상의 요소로 이뤄진다.
  - 각 요소는 일반적으로 8자 이하의 짧은 단어로 한다.(utilies 보다는 util)
  - 요소의 이름은 보통 한 단어 혹은 약어로 이뤄진다.
- 많은 기능을 제공하는 경우엔 계층을 나눠 더 많은 요소로 구성해도 좋다.
- 클래스와 인터페이스의 이름은 하나 이상의 단어로 이뤄지며, 각 단어는 대문자로 시작한다.
- 여러 단어의 첫 글자만 딴 약자나 max, min 처럼 널리 통용되는 줄임말을 제외하고는 줄이면 안된다.
- 메서드와 필드 이름은 첫 글자를 소문자로 쓰는 것 외에는 클래스와 같다.
- 상수 필드는 구성하는 단어 모두 대문자로 쓰며, 단어 사이는 밑줄로 구분한다.
- 타입 매개변수 이름은 보통 한 문자로 표현한다.
  - 임의이 타입: T
  - 컬렉션 원소 타입: E
  - 맵의 키와 값: K, V
  - 예외: X
  - 메서드 반환 타입: R
  - 그 외: T, U, V 또는 T1, T2, T3

### 문법 규칙

- 문법 규칙은 철자 규칙과 비교하면 더 유연하고 논란도 많다.
- 객체를 생성할 수 있는 클래스의 이름은 단수 명사나 명사구를 사용한다.
- 객체를 생성할 수 없는 클래스는 보통 복수형 명사로 짓는다
- 인터페이스의 이름은 클래스와 똑같이 짓거나 able, ible로 끝나는 형용사로 짓는다.
- 애너테이션은 명사, 동사, 전치사, 형용사 두루두루 쓰인다.
- 어떤 동작을 수행하는 메서드의 이름은 동사나 동사구로 짓는다.
- boolean 값을 반환하는 메서드라면 is나 has로 시작하고 명사나 명사구 혹은 형용사로 끝나는 것이 좋다.
- 반환 타입이 boolean이 아니거나 해당 인스턴스의 속성을 반환하는 메서드의 이름은 보통 명사, 명사구, get으로 시작하는 동사구로 짓는다.
- 객체의 타입을 바꿔서 다른 객체를 반환하는 경우 보통 toType 형태로 짓는다.
- 객체의 내용을 다른 뷰로 보여주는 메서드는 asType으로 짓는다
- 객체의 값을 기본 타입 값으로 반환하는 메서드의 이름은 보통 typeValue 형태(intValue)로 짓는다.
- 정적 펙토리의 이름은 from, of, valueOf, instance, getInstance, newInstance, getType, newType을 흔히 사용한다.
