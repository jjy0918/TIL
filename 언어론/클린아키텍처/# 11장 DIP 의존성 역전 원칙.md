# 11장 DIP 의존성 역전 원칙

- 의존성 역전 원칙에서 말하는 `유연성이 극대환된 시스템`이란 소스 코드 의존성이 추상에 의존하며 구체에는 의존하지 않는 시스템을 말한다.
- 자바와 같은 정적 타입 언어에서 use, impor, include 구문은 오직 인터페이스나 추상 클래스 같은 추상적인 선언만 참조해야 한다는 뜻이다.
  - 다만, 안전성이 보장된 환경에서는 무시하는 편이다.
  - 자바에서 String은 구체 클래스이지만, 자주 변경이 발생할 것이라는 염려도 없고, 엄격하게 통제되어 구체 클래스를 참조한다.
- 루비나 파이썬 같은 동적 타입 언어에서도 동일한 규칙이 적용된다.
- 의존하지 않도록 피하고자 하는 것은 바로 변동성이 큰 구체적인 요소다.

## 안정된 추상화

- 추상 인터페이스에 변경이 생기면 이를 구체화한 구현체들도 따라서 수정해야 한다.
- 구체적인 구현체에 변경이 생기더라도 그 구현체가 구현하는 인터페이스는 대다수의 경우 변경될 필요가 없다.
- 즉, 인터페이스는 구현체보다 변동성이 낮다.
- 뛰어난 소프트웨어 설계자와 아키텍트는 인터페이스 변동성을 낮추기 위해 애쓰며, 인터페이스를 변경하지 않고 구현체에 기능을 추가할 수 있는 방법을 찾는다.
- 안정된 소프트웨어 아키텍처란 변동성이 큰 구현체에 의존하는 일을 지양하고, 안정된 추상 인터페이스를 선호하는 아키텍처라는 뜻이다.

### 안정된 추상화 실천법

- 변동성이 큰 구체 클래스를 참조하지 말고 추상 인터페이스를 참조하라.
  - 이 규칙은 객체 생성 방식을 강하게 제약하며, 일반적으로 추상 펙토리를 사용하도록 강제한다.
- 변동성이 큰 구체 클래스로부터 파생하지 말라.
- 구체 함수를 오버라이드 하지 말라.
  - 구체 함수를 오버라이드 하면 의존성을 제거할 수 없게 된다.
  - 의존성을 제거하기 위해 차라리 추상 함수로 선언하라.
- 구체적이며 변동성이 크다면 절대로 그 이름을 언급하지 말라.

## 팩토리

- 변동성이 큰 구체적인 객체는 특별히 주의해서 생성해야 한다.
- 대부분의 언어는 객체를 생성하기 위해 해당 객체를 구체적으로 정의한 코드에 대해 소스 코드 의존성이 발생하게 된다.
- 이를 해결하기 위해 추상 팩토리를 사용한다.
- 추상 팩토리를 통해 구체 클래스를 가져와서 사용한다.
- 이러한 과정은 추상 컴포넌트와 구체 컴포넌트로 나뉘어진다.
- 추상 컴포넌트에서는 고수준의 작업을 진행하고, 구체 컴포넌트는 업무 규칙을 다루기 위해 필요한 모든 세부사항을 포함한다.
- 구체 컴포넌트가 추상 컴포넌트에게 구체 객체를 전달하고, 추상 컴포넌트는 전달 받은 구체 객체를 인터페이스를 이용하여 사용한다.

## 구체 컴포넌트

- 구체 컴포넌트에는 구체적인 의존성이 존재할 수 있다.
- 이는 DIP에 위배되지만, 일반적인 일이다.
- DIP 위배를 모두 없앨 수는 없지만, DIP를 위배하는 클래스들은 적은 수의 구체 컴포넌트 내부로 모을 수 있다.
  - 이를 통해 시스템의 나머지 부분과는 분리할 수 있게 된다.
- 시스템은 구체 컴포넌트를 최소한 하나 포함할 것이고, 이를 흔히 메인(main)이라 부른다.
