# 23장 프레젠터와 험블 객체

- 프레젠터는 험블 객체 패턴을 따른 형태로, 아키텍처 경계를 식별하고 보호하는 데 도움이 된다.

## 험블 객체 패턴

- 험블 객체 패턴은 디자인 패턴으로, 테스트하기 어려운 행위와 테스트하기 쉬운 행위를 단위 테스트 작성자가 분리하기 쉽게 하는 방법으로 고안되었다.
- 행위들을 두 개의 모듈 또는 클래스로 나눈다.
- 가장 기본적인 본질은 남기고, 테스트 하기 어려운 행위를 험블 객체로 옮긴다.
- GUI의 경우 화면에 적절하게 표시되었는지 테스트하기 어렵기 때문에 험블 객체로 만들고, 행위는 테스트 쉽기 때문에 그대로 둔다.
- 험블 객체 패턴을 사용하여 GUI를 뷰와 프레젠터로 만들게 된다.


## 프레젠터와 뷰

- 뷰는 험블 객체이고 테스트하기 어렵다.
- 뷰에 포함된 코드는 가능한 간단하게 유지한다.
- 뷰는 데이터를 GUI로 이동시키지만, 데이터를 직접 처리하지는 않는다.
- 프레젠터는 테스트하기 쉬운 객체다.
- 프레젠터의 역할은 애플리케이션으로부터 데이터를 받아 화면에 표현할 수 있는 포맷으로 만드는 것이다.
- 뷰는 뷰 모델의 데이터를 화면으로 로드할 뿐이며, 이 외에 뷰가 맡은 역할은 전혀 없다.

## 테스트와 아키텍처

- 테스트 용이성은 좋은 아키텍처가 지녀야 할 속성으로 오랫동안 알려져 왔다.
- 험블 객체 패턴의 경우 행위를 테스트하기 쉬운 부분과 어려운 부분으로 나누어 아키텍처 경계를 정의시켜준다.

## 데이터베이스와 게이트웨이

- 유스케이스 인터렉터와 데이터베이스 사이에는 데이터베이스 게이트웨이가 위치한다.
- 이 게이트웨에는 다형적 인터페이스로, 애플리케이션이 데이터베이스에 수행하는 생성, 조회, 갱신, 삭제 작업과 관련된 모든 메서드를 포함한다.
- 유스케이스 계층은 SQL을 허용하지 않기 때문에 필요한 메서드를 제공하는 게이트웨이 인터페이스를 호출한다.
- 인터페이스 구현체는 데이터베이스 계층에 위치한다.
- 인터페이스 구현체는 험블 객체다.
  - 직접 SQL을 작성하여 데이터베이스에 필요한 데이터에 접근한다.
  - 테스트가 어렵다.
- 인터랙터는 애플리케이션 특화된 업무 규칙을 캡슐화하여 험블 객체가 아니다.
  - 테스트하기가 쉽다.

## 데이터 매퍼

- 객체 관계 매퍼(ORM) 같은 건 사실 존재하지 않는다.
- 객체는 데이터 구조가 아니다.
- 데이터는 모두 private으로 선언되므로 객체 사용자는 데이터를 볼 수 없고, public 메서드만 볼 수 있다.
  - 사용자 관점에서 객체는 단순히 오퍼레이션의 집합이다.
- 객체와 달리 데이터 구조는 함축된 행위가 아닌 public 데이터 변수 집합이다.
- ORM 보다는 데이터 매퍼라고 부르는 편이 나아 보인다.
- ORM 시스템은 데이터베이스 계층에 위치하며, 게이트웨이 인터페이스와 데이터베이스 사이에서 일종의 또 다른 험블 객체 경계를 형성한다.

## 서비스 리스너

- 애플리케이션이 다른 서비스와 통신해야 한다면 또는 서비스를 제공해야 한다면 험블 패턴을 발견할 수 있다.
- 외부와 통신하기 위해 내부 포맷을 외부 포맷으로, 외부 포맷을 내부 포맷으로 변경한 후 경계를 가로질러서 전달하게 된다.

## 결론

- 각 아키텍처 경계마다 경계 가까이 숨어 있는 험블 객체 패턴을 발견할 수 있다.
- 경계를 넘나드는 통신은 거의 모두 간단한 데이터 구조를 수반할 때가 많고, 대개 그 경계는 테스트하기 어려운 무언가와 테스트하기 쉬운 무언가와 분리된다.
- 아키텍처 경계에서 험블 객체 패턴을 사용하면 전체 시스템의 테스트 용이성을 크게 높일 수 있다.