# 27장 크고 작은 모든 서비스들

- 서비스 지향 아키텍처와 마이크로서비스 아키텍처는 큰 인기를 끌고 있다.

## 서비스 아키텍처?

- 서비스를 사용한다는 것이 본질적으로 아키텍처에 해당하지는 않는다.
- 시스템 아키텍처는 의존성 규칙을 준수하며 고수준의 정책을 저수준의 세부사항으로부터 분리하는 경계에 의해 정의된다.
  - 단순히 애플리케이션의 행위를 분리할 뿐인 서비스는 비싼 함수 호출에 불과하다.
- 모든 서비스가 반드시 아키텍처 관점에서 중요해야만 하는 것은 아니다.
  - 독립적으로 잘 분리된 서비스는 의존성 규칙과 상관없이 큰 도움이 될 때가 많다.
- 모노리틱 시스템이나 컴포넌트 기반 시스템에서 아키텍처를 정의하는 요소는 의존성 규칙을 따르며 아키텍처 경계를 넘나드는 함수 호출들이다.
  - 나머지 함수들은 행위를 서로 분리할 뿐이다.
- 서비스는 프로세스나 플랫폼 경계를 가로지르는 함수 호출에 지나지 않는다.
- 아키텍처적으로 중요한 서비스도 있지만, 중요하지 않는 서비스도 존재한다.

## 서비스의 이점?

### 결합 분리의 오류

- 시스템을 서비스들로 분리함으로써 얻게 되리라 예상되는 큰 이점 하나는 서비스 사이의 결합이 확실히 분리된다는 점이다.
- 서비스는 서로 다른 프로세서에서 실행되어 다른 서비스의 변수에 직접 접근할 수 없다.
- 모든 서비스의 인터페이스는 반드시 잘 정의되어 있어야 한다.
- 하지만, 프로세서 내의 또는 네트워크 상의 공유 자원 때문에 결합될 가능성은 여전히 존재한다.
  - 서비스 사이를 오가는 데이터 레코드에 새로운 필드를 추가한다면, 이 필드를 사용하는 모든 서비스는 반드시 변경되어야 한다.
  - 서비스의 인터페이스가 잘 정의되어 있어야 하는 것은 사실이지만, 함수의 경우에도 전혀 다르지 않다.

### 개발 및 배포 독립성의 오류

- 서비스를 사용함에 따라 전담팀이 서비스를 소유하고 운영한다는 점이 장점으로 여겨진다.
- 대규모 엔터프라이즈 시스템을 독립적으로 개발하고 배포 가능한 수십, 수백, 수천 개의 서비스들을 이용하여 만들 수 있다고 믿는다.
- 이러한 이점은 극히 일부일 뿐이다.
- 대규모 엔터프라이즈 시스템을 확장 가능하게 만드는 것은 모노리틱 시스템이나 컴포넌트 시스템으로도 구축할 수 있다.
- 결합 분리의 오류에 따르면, 서비스라고 해서 항상 독립적으로 개발, 배포, 운영할 수 있는 것이 아니다.
  - 데이터나 행위에서 어느 정도 결합되어 있다면 결합된 정도에 맞게 개발, 배포, 운영을 조정해야 한다.

## 야옹이 문제

- 택시 시스템을 `Taxi UI`, `Taxi Finder`, `Taxi Selector`, `Taxi Dispatcher`, `Taxi Supplier` 로 서비스를 분리하여 운영한다고 가정해보자.
- 초기에는 서비스들이 각각 개발, 배포, 운영에 문제 없이 동작한다.
- 이때 새로운 기능(야옹이 배달)이 추가될 경우 모든 서비스들이 영향을 받으며 서로간 엮인 상태로 개발, 배포, 운영이 되어야 한다.
- 이러한 문제는 횡단 관심사가 지닌 문제다.
  - 위 예시와 같은 형태의 기능적 분해는 새로운 기능이 기능적 행위를 횡단하는 상황에 매우 취약하다.
- 이러한 것을 해결하기 위해서는 다형적으로 확장할 수 있는 클래스 집합을 생성하여 새로운 기능을 처리하도록 하면 된다.
- 기본 틀은 유지하지만, 컴포넌트 단위를 각 기능(택시, 야옹이) 별로 분리하여 기능별로 개발, 배포, 운영할 수 있게 한다.
  - 템플릿 메서드나 전략 패턴등을 이용하면 된다.
- 이러한 방식으로 하더라도, 결국 `Taxi UI` 는 어쩔 수 없이 변경되어야 하지만, 그 외의 것들은 변경할 필요가 없다.

## 컴포넌트 기반 서비스

- 서비스에서도 이렇게 할 수 있다.
- 서비스도 SOLID 원칙대로 설계할 수 있으며, 컴포넌트 구조를 갖출 수도 있다.
- 이를 통해 서비스 내의 기존 컴포넌트들을 변경하지 않고도 새로운 컴포넌트를 추가할 수 있다.

## 횡단 관심사

- 아키텍처 경계는 서비스 사이에 있지 않고 오히려 서비스를 관통하며, 서비스를 컴포넌트 단위로 분할한다.
- 모든 주요 시스템이 직면하는 횡단 관심사를 처리하려면, 서비스 내부는 의존성 규칙도 준수하는 컴포넌트 아키텍처로 설계해야 한다.
- 이 서비스들은 시스템의 아키텍처 경계를 정의하지 않고, 아키텍처 경계를 정의하는 것은 서비스 내에 위치한 컴포넌트다.

## 결론

- 서비스는 시스템의 확장성과 개발 가능성 측면에서 유용하지만, 그 자체로는 아키텍처적으로 그리 중요한 요소는 아니다.
- 시스템의 아키텍처는 시슽넴 내부에 그어진 경계와 경계를 넘나드는 의존성에 의해 정의된다.
- 시스템의 구성 요소가 통신하고 실행되는 물리적인 메커니즘에 의해 아키텍처가 정의되는 것이 아니다.
- 서비스는 단 하나의 아키텍처 경계로 둘러싸인 단일 컴포넌트로 만들 수 있다.
  - 혹은 여러 아키텍처 경계로 분리된 다수의 컴포넌트로 구성할 수도 있다.
- 드물게 클라이언트와 서비스가 강하게 결합되어 아키텍처적으로 아무런 의미가 없을 때도 있다.