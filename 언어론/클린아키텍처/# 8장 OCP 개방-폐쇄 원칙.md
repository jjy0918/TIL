# 8장 OCP 개방-폐쇄 원칙

## OCP 란

- 개방-폐쇄 원칙(OCP)이란 `소프트웨어 개체는 확장에는 열려 있어야 하고, 변경에는 닫혀 있어야 한다`를 말한다.
- 즉, 소프트웨어 개체의 행위는 확장할 수 있어야 하지만, 이때 변경해서는 안 된다.

## 사고 실험

- 재무제표를 웹 페이지로 보여주는 시스템이 있다.
  - 웹 페이지에 표시되는 데이터는 스크롤 할 수 있으며, 음수는 빨간색으로 출력한다.
- 이해관계자가 새로운 기능을 요청한다면 새로운 코드를 작성해야 하고, 원래 코드도 수정이 된다.
  - 동일한 정보를 보고서 형태로 변환하여 흑백 프린터로 요청
- 이때 소프트웨어 아키텍처가 훌륭하다면, 변경된는 코드 양이 최소화될 것이다.
  - 서로 다른 목적으로 변경되는 요소를 적절하게 분리하고(SRP), 요소 사이의 의존성을 체계화하여(DIP) 변경량을 최소화 시킨다.
- SRP를 적용할 경우 `재무 데이터 검사 -> 보고서용 데이터 생성 -> 필요에 따라 두 가지 보고서 생성 절차 확인 후 포매팅` 형태로 변경할 수 있다.
  - 보고서 생성을 두 개의 책임으로 분리했기 때문에 두 책임 중 하나에서 변경이 발생하더라도 다른 하나는 변경되지 않는다.
- 이러한 방식을 제대로 적용하기 위해서는, 처리 과정을 `클래스`단위로 분할하고, 이들을 `컴포넌트`단위로 구분해야 한다.
- 각 컴포넌트는 여러개의 클래스로 구성된다.
- 컴포넌트 내부의 클래스들은 서로가 다양한 방식으로 연결되어 있지만, 컴포넌트들 간에는 단방향으로만 이루어져야 한다.
- 컴포넌트들 간에는 단방향으로 이루어짐에 따라 변경으로부터 컴포넌트들을 분리, 보호할 수 있게 된다.
- 컴포넌트들 간의 방향에 따라 계층구조가 만들어진다.
  - Interactor는 가장 높은 수준의 개념이며, 최고의 보호를 받게 된다.
  - View는 가장 낮은 수준의 개념 중 하나며, 거의 보호를 받지 못한다.
  - Presenter는 View보다 높고 Controller나 Interactor 보다는 낮은 수준에 위치한다.
- 아키텍트는 기능이 어떻게, 왜, 언제 발생하는지에 따라 기능을 분리하고, 분리한 기능을 컴포넌트의 계층구조로 조직화한다.
- 컴포넌트 계층구조를 조직화함에 따라 저수준 컴포넌트에서 발생한 변경으로부터 고수준 컴포넌트를 보호할 수 있다.

## 방향성 제어

- FinancialDataGateWay 인터페이스는 FinincialReportGenerator와 FinalcialDataMapper 사이에 위치한다.
- FinancialDataGateWay 인터페이스가 중간에 있기 때문에 의존성 역전이 발생하게 된다.
- FinancialDataGateWay 인터페이스가 없었다면, 의존성은 Interactor 컴포넌트에서 Database 컴포넌트로 바로 향하게 된다.

## 정보 은닉

- FinalcialReportRequester 인터페이스 방향성 제어와 다른 목적을 가진다.
- FinalcialReportRequester 를 통해 Controller가 Interactor 내부에 대해 너무 알지 못하도록 막아준다.
- FinalcialReportRequester 인터페이스가 없었다면, Controller는 FinancialEntities에 대해 추이 종속성을 가지게 된다.
  - 추이 종속성을 가지게 되면, 소프트웨어 엔티티는 `자신이 직접 사용하지 않는 요소에는 절대로 의존해서는 안 된다`는 원칙을 위반하게 된다.
- Interactor 내부를 은닉하여 Interactor에서 발생한 변경으로부터 Controller도 보호한다.

## 결론

- OCP는 시스템의 아키텍처를 떠받치는 원동력 중 하나다.
- OCP의 목표는 시스템을 확장하기 쉬운 동시에 변경으로 인해 시스템이 너무 많은 영향을 받지 않도록 하는 데 있다.
- 이를 위해 시스템을 컴포넌트 단위로 분리하고, 저수준 컴포넌트에서 발생한 변경으로부터 고수준 컴포넌트를 보호할 수 있는 형태의 의존성 계층구조가 만들어지도록 해야 한다.